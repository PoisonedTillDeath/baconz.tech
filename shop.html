<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>lululemon | Premium Performance Apparel</title>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@500;700;900&family=Inter:wght@300;400;600&display=swap" rel="stylesheet"/>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet"/>
  <style>
    :root{
      --bg:#0d1512;
      --surface:rgba(26,47,40,0.97);
      --text:#EAD9B7;
      --muted:#94a3b8;
      --accent:#C2A878;
      --accent-strong:#C47A3C;
      --glass: rgba(255,255,255,0.06);
    }
    .serif{font-family:'Playfair Display',serif}
    .sans{font-family:'Inter',sans-serif}
    @keyframes fadeInBlur{0%{opacity:0;filter:blur(14px)}100%{opacity:1;filter:blur(0)}}
    @keyframes slideUp{0%{opacity:0;transform:translateY(40px)}100%{opacity:1;transform:translateY(0)}}
    @keyframes fadeOutDown{0%{opacity:1;transform:translateY(0)}100%{opacity:0;transform:translateY(18px)}}
    @keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.15)}}
    @keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-8px)}}
    @keyframes spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}
    @keyframes successPop{0%{transform:scale(0);opacity:0}50%{transform:scale(1.2)}100%{transform:scale(1);opacity:1}}
    @keyframes cardGlow{0%,100%{box-shadow:0 0 20px rgba(194,168,120,0.3)}50%{box-shadow:0 0 40px rgba(194,168,120,0.6)}}
    .animate-blur{animation:fadeInBlur .7s ease forwards}
    .animate-slide{animation:slideUp .6s ease forwards}
    .animate-float{animation:float 3s ease-in-out infinite}
    .animate-spin{animation:spin 1s linear infinite}
    .animate-success{animation:successPop .5s ease forwards}
    .animate-glow{animation:cardGlow 2s ease-in-out infinite}
    /* Hero slideshow background */
    .hero-slides{position:absolute;inset:0;z-index:0;overflow:hidden}
    .hero-slide{position:absolute;inset:0;background-position:center;background-size:cover;background-repeat:no-repeat;opacity:0;transition:opacity 1s ease;filter:contrast(.95) saturate(.9);will-change:opacity}
    .hero-slide.active{opacity:1}
    /* Page transition utilities */
    .page{opacity:1;transition:opacity .42s cubic-bezier(.2,.9,.2,1),transform .42s cubic-bezier(.2,.9,.2,1)}
    .page-hidden{opacity:0;pointer-events:none}
    .page-enter{animation:slideUp .45s cubic-bezier(.2,.9,.2,1) forwards}
    .page-leave{animation:fadeOutDown .28s cubic-bezier(.2,.9,.2,1) forwards}
    .nav-link{position:relative}
    .nav-link:after{content:'';position:absolute;left:0;bottom:-4px;width:0;height:2px;background:#C47A3C;transition:.3s}
    .nav-link:hover:after{width:100%}
    .glass{background:rgba(255,255,255,0.08);backdrop-filter:blur(20px);border:1px solid rgba(255,255,255,0.1)}
    .btn-gold{background:linear-gradient(135deg,var(--accent),#D4B896);color:#08120a;font-weight:600;transition:all .3s}
    .btn-gold:hover{transform:scale(1.05);box-shadow:0 10px 40px rgba(194,168,120,0.3)}
    .product-card{transition:box-shadow .4s cubic-bezier(.4,0,.2,1),transform .25s cubic-bezier(.4,0,.2,1);box-shadow:0 5px 24px rgba(17,33,27,0.14)}
    .product-card{position:relative;overflow:hidden;border-radius:16px}
    .product-card .inner{transition:transform .45s cubic-bezier(.2,.9,.2,1),box-shadow .45s;transform-origin:center bottom}
    .product-card:hover .inner{transform:translateY(-12px) scale(1.03);box-shadow:0 30px 70px rgba(0,0,0,0.55)}
    .product-image-wrap{position:relative;overflow:hidden;border-radius:12px}
    .product-image-wrap img{width:100%;height:18.5rem;object-fit:cover;transition:transform .7s ease}
    .product-card:hover .product-image-wrap img{transform:scale(1.08) translateY(-6px)}
    .product-badge{position:absolute;left:12px;top:12px;background:var(--accent);color:#09120f;padding:.35rem .6rem;border-radius:999px;font-weight:800;font-size:12px}
    .product-overlay{position:absolute;left:0;right:0;bottom:0;padding:12px;background:linear-gradient(180deg,transparent,rgba(0,0,0,0.45));display:flex;gap:8px;align-items:center;justify-content:space-between;transform:translateY(100%);transition:transform .35s ease}
    .product-card:hover .product-overlay{transform:translateY(0%)}
    .product-name{font-weight:700}
    .price-pill{background:rgba(0,0,0,0.6);padding:.4rem .6rem;border-radius:.6rem;font-weight:800}
    .btn-small{background:rgba(255,255,255,0.06);border:1px solid rgba(255,255,255,0.06);padding:.45rem .75rem;border-radius:999px;font-weight:700}
    .btn-small:hover{background:#C2A878;color:#08120a}
    .card-highlight{animation:highlightPulse .9s ease;box-shadow:0 12px 40px rgba(194,168,120,0.45);border:1px solid rgba(194,168,120,0.75)}
    @keyframes highlightPulse{0%{transform:scale(1);box-shadow:0 8px 24px rgba(194,168,120,0.18)}50%{transform:scale(1.02);box-shadow:0 18px 50px rgba(194,168,120,0.38)}100%{transform:scale(1);box-shadow:0 8px 24px rgba(194,168,120,0.18)}}
    .toast{animation:slideUp .4s ease}
    .card-container{perspective:1000px;width:320px;min-width:275px;height:200px}
    .card-inner{position:relative;width:100%;height:100%;transition:transform .8s;transform-style:preserve-3d}
    .card-inner.flipped{transform:rotateY(180deg)}
    .card-front,.card-back{position:absolute;width:100%;height:100%;backface-visibility:hidden;border-radius:16px;padding:24px}
    .card-front{background:linear-gradient(135deg,#1a2f28 0%,#2a4a3f 50%,#1a2f28 100%)}
    .card-back{background:linear-gradient(135deg,#2a4a3f 0%,#1a2f28 100%);transform:rotateY(180deg)}
    .input-glow:focus{box-shadow:0 0 20px rgba(194,168,120,0.4);border-color:var(--accent)}
    input[type="text"], input[type="search"], textarea { color: var(--text); }
    ::placeholder{ color: rgba(234,217,183,0.6); }
    /* override Tailwind classes for a few elements to use palette vars */
    #cartCount{ background:var(--accent-strong); }
    #navbar{ background: linear-gradient(180deg, rgba(26,47,40,0.95), rgba(17,33,27,0.75)); }
    #mobileSearchBar{ background: rgba(17,33,27,0.92); }
    /* Admin search input styling */
    .admin-search-input{
      width:100%;
      padding:.6rem .9rem;
      border-radius:.7rem;
      background:var(--glass);
      border:1px solid rgba(255,255,255,0.06);
      color:var(--text);
      font-weight:600;
      box-shadow: none;
      transition:box-shadow .18s, border-color .18s, transform .12s;
    }
    .admin-search-input:focus{outline:none;box-shadow:0 8px 30px rgba(194,168,120,0.12);border-color:var(--accent);transform:translateY(-1px)}
    /* Chat input styling */
    .chat-input{
      width:100%;
      padding:.6rem .9rem;
      border-radius:.9rem;
      background:var(--glass);
      border:1px solid rgba(255,255,255,0.06);
      color:var(--text);
      font-weight:600;
      box-shadow:inset 0 -6px 14px rgba(0,0,0,0.22);
      transition:box-shadow .18s, border-color .12s, transform .12s;
      font-size:0.98rem;
    }
    .chat-input:focus{outline:none;box-shadow:0 8px 30px rgba(194,168,120,0.12);border-color:var(--accent);transform:translateY(-1px)}
    /* Careers form theming — broader selector and important to override utility classes */
    #careersPage #careersForm input,
    #careersPage #careersForm textarea,
    #careersPage #careersForm select {
      background: var(--glass) !important;
      border: 1px solid rgba(255,255,255,0.06) !important;
      color: var(--text) !important;
      padding: .75rem 1rem !important;
      border-radius: .8rem !important;
      font-weight: 600 !important;
      transition: box-shadow .15s, border-color .12s, transform .08s;
    }
    #careersPage #careersForm input::placeholder, #careersPage #careersForm textarea::placeholder{ color: rgba(234,217,183,0.45) !important; }
    #careersPage #careersForm input:focus, #careersPage #careersForm textarea:focus{ outline:none; box-shadow: 0 10px 30px rgba(194,168,120,0.08) !important; border-color: var(--accent) !important; transform: translateY(-1px) !important;}    
    #careersPage #careersForm .glass{ background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)) !important; }
    #applyResumeName{ font-weight:600; color:var(--muted); margin-left: .6rem; font-size:0.95rem }
    /* make upload button pair nicely with file name */
    #careersPage #careersForm .glass.upload-btn{ display:inline-flex; align-items:center; gap:.6rem }
    /* Users table scroll shadows */
    #adminUsersTable{position:relative}
    #adminUsersTable::before,#adminUsersTable::after{content:'';position:absolute;left:0;right:0;height:28px;pointer-events:none;opacity:0;transition:opacity .18s}
    #adminUsersTable::before{top:0;background:linear-gradient(180deg,rgba(13,21,18,0.9),transparent)}
    #adminUsersTable::after{bottom:0;background:linear-gradient(0deg,rgba(13,21,18,0.9),transparent)}
    #adminUsersTable.has-scroll::before{opacity:1}
    #adminUsersTable:not(.at-bottom)::after{opacity:1}  
    .admin-user-row{transition:transform .18s ease, background .18s;will-change:transform}
    #adminUsersTable.scrolling .admin-user-row{transform:translateY(-2px)}
    /* native scrollbar left as default; overlay indicator removed */
    .tab-active{background:rgba(194,168,120,0.2);border-color:#C2A878;color:#C2A878}
    /* Support FAB */
    .support-fab{position:fixed;bottom:32px;right:32px;background:var(--accent);width:58px;height:58px;z-index:90;display:flex;align-items:center;justify-content:center;border-radius:100vw;cursor:pointer;box-shadow:0 8px 40px rgba(194,168,120,0.25);transition:transform .2s;}
    .support-fab:hover{transform:scale(1.11);box-shadow:0 14px 50px rgba(194,168,120,0.32);}
    @media(max-width:600px){.support-fab{right:16px;bottom:16px}}
    .faq-q{cursor:pointer;padding:16px 0 8px 0;border-bottom:1px solid #2a4a3f;}
    .faq-a{display:none;padding-left:8px;padding-bottom:16px;color:#ead9b7;}
    .faq-q.active{color:#C2A878;}
    /* Testimonials background images */
    .testimonial-card{position:relative;overflow:hidden}
    .testimonial-card .testimonial-bg{position:absolute;inset:0;background-position:center;background-size:cover;opacity:0.12;filter:blur(4px) saturate(.9);pointer-events:none}
    .testimonial-card .testimonial-overlay{position:absolute;inset:0;background:linear-gradient(180deg,rgba(13,21,18,0.0),rgba(13,21,18,0.45));pointer-events:none}
    /* For product modal gallery */
    .thumb{width:48px;height:48px;object-fit:cover;border-radius:9px;border:2px solid #2a4a3f;cursor:pointer;transition:.19s;}
    .thumb.selected{border-color:#C2A878;}
    .size-btn{border:2px solid #eee;background:rgba(255,255,255,0.03);padding:.6em 1.2em;border-radius:1em;cursor:pointer;font-weight:600;margin:.1em;}
    .size-btn.selected,.size-btn:hover{border-color:#C2A878;color:#C2A878;background:rgba(194,168,120,0.07);}
    .color-dot{width:28px;height:28px;border-radius:50%;border:2px solid #eee;margin-right:8px;cursor:pointer;transition:.13s;}
    .color-dot.selected,.color-dot:hover{border-color:#C2A878;}
    /* Fullscreen Checkout */
    #checkoutModal.fullscreen {
      position: fixed; top: 0; left: 0;
      width: 100vw; height: 100vh;
      min-width: 0; min-height: 0;
      z-index: 120;
      display: flex !important;
      align-items: center; justify-content: center;
      background: rgba(13,21,18,0.97);
      padding: 0; margin: 0;
    }
    .checkout-flex-wrapper {
      width: 100%;
      max-width: 920px; /* bigger, more square */
      background: rgba(26,47,40,0.98);
      border-radius: 0.7rem; /* squarer corners */
      box-shadow: 0 18px 80px rgba(0,0,0,0.55);
      margin: 28px;
      min-height: 78vh;
      padding: 2rem 1.4rem; /* more breathing room */
      max-height: 94vh;
      overflow-y: auto;
    }
    /* Tip UI */
    .tip-presets{display:flex;gap:.5rem;flex-wrap:wrap}
    .tip-btn{background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.06);padding:.5rem .8rem;border-radius:.6rem;cursor:pointer;font-weight:700}
    .tip-btn.selected{background:var(--accent);color:#08120a;border-color:var(--accent)}
    .tip-input{width:120px;padding:.5rem .6rem;border-radius:.6rem;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.06);color:var(--text);font-weight:700}
    /* Navbar hide animation */
    #navbar {
      transition: top .42s cubic-bezier(.23,.7,.27,1), background 0.25s;
      will-change: top;
    }
    #navbar.hide {
      top: -100px !important;
    }
    @media(max-width:600px){
      .checkout-flex-wrapper { max-width: 100vw; margin:0; border-radius:0; min-height:100vh; padding:1em 0.2em;}
    }
    @media (max-width:440px) {
      .checkout-flex-wrapper{padding:0.3em 0;}
      .card-container{width:99vw;min-width:0;}
      .product-detail-modal .glass{padding:0;}
    }
    /* Custom dropdown styles */
    .custom-dropdown{position:relative;font-family:Inter, sans-serif}
    .custom-dropdown-btn{background:transparent;border:1px solid rgba(255,255,255,0.06);padding:.45rem .7rem;border-radius:0.6rem;color:var(--text);display:flex;align-items:center;gap:.6rem;cursor:pointer}
    .custom-dropdown-btn .caret{transition:transform .18s}
    .custom-dropdown.open .custom-dropdown-btn .caret{transform:rotate(180deg)}
    .custom-dropdown-menu{position:absolute;right:0;top:calc(100% + .6rem);background:rgba(17,33,27,0.95);border:1px solid rgba(255,255,255,0.06);min-width:160px;border-radius:.6rem;padding:.35rem;box-shadow:0 8px 24px rgba(0,0,0,0.6);z-index:80;display:none}
    .custom-dropdown.open .custom-dropdown-menu{display:block}
    .custom-dropdown-item{padding:.55rem .6rem;border-radius:.5rem;color:#EAD9B7;cursor:pointer;font-weight:600}
    .custom-dropdown-item:hover{background:rgba(194,168,120,0.08);color:#C2A878}
    .custom-dropdown-item.active{background:rgba(194,168,120,0.12);color:#C2A878}
    /* (removed simulated header delay) */
    /* Admin styles */
    .admin-metrics{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
    .admin-card{padding:1rem;border-radius:12px;background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));border:1px solid rgba(255,255,255,0.04)}
    .admin-card:hover{transform:translateY(-6px);box-shadow:0 18px 60px rgba(0,0,0,0.45)}
    .admin-order{padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);display:flex;justify-content:space-between;align-items:center;transition:all .18s}
    .admin-order:hover{background:rgba(194,168,120,0.03);transform:translateY(-4px)}
    .admin-action-btn{background:#C2A878;color:#06110a;padding:.45rem .7rem;border-radius:.6rem;font-weight:700;cursor:pointer;border:none}
    .admin-action-btn.danger{background:#ff6b6b;color:#1f0f0f}
    .admin-return{padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);margin-bottom:6px}
    .admin-explain textarea{width:100%;min-height:64px;padding:8px;border-radius:8px;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.05);color:#ead9b7}
    #adminDisclaimerModal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,0.7);z-index:140}
    #adminDisclaimerModal .glass{max-width:720px}
  </style>
</head>

<body class="bg-[#0d1512] text-white font-sans overflow-x-hidden relative">

<!-- debug overlay (appears briefly when navigating) -->
<div id="pageDebug" style="position:fixed;top:14px;right:14px;background:var(--accent);color:#08120a;padding:8px 12px;border-radius:999px;font-weight:800;z-index:200;display:none;box-shadow:0 8px 30px rgba(0,0,0,0.4)"></div>

<!-- Toast -->
<div id="toast" class="fixed top-24 right-6 z-[100] hidden">
  <div class="glass px-6 py-4 rounded-2xl flex items-center gap-3 toast">
    <i class="fa-solid fa-check-circle text-[#C2A878] text-xl"></i>
    <span id="toastMsg">Added to cart!</span>
  </div>
</div>

<!-- Navbar -->
<nav id="navbar" class="fixed top-0 left-0 w-full bg-[#11211b]/80 backdrop-blur-2xl border-b border-white/10 flex items-center justify-between px-6 md:px-16 py-4 z-50 transition-transform duration-500">
  <h1 id="siteTitle" class="serif text-2xl font-bold tracking-wide cursor-pointer" onclick="showPage('home')">lululemon</h1>
  <div class="hidden md:flex items-center gap-8 text-lg absolute left-1/2 -translate-x-1/2">
    <span class="nav-link cursor-pointer" onclick="showPage('home')">Home</span>
    <span class="nav-link cursor-pointer" onclick="document.getElementById('products').scrollIntoView({behavior:'smooth'})">Shop</span>
    <span class="nav-link cursor-pointer" onclick="showPage('collections')">Collections</span>
    <span class="nav-link cursor-pointer" onclick="document.getElementById('aboutSection').scrollIntoView({behavior:'smooth'})">About</span>
    
  </div>
  <div class="flex items-center gap-3 relative">
    <!-- Hidden native select as fallback -->
    <select id="categorySelect" class="hidden" onchange="onCategorySelect(this.value)"><option value="all">All</option></select>
    <!-- Custom dropdown (desktop) -->
    <div id="categoryDropdown" class="custom-dropdown hidden md:block ml-4" aria-expanded="false">
      <button id="categoryDropdownBtn" class="custom-dropdown-btn" type="button" aria-haspopup="true">
        <span id="categoryDropdownLabel">All</span>
        <svg class="caret" width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6 9l6 6 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
      </button>
      <div id="categoryDropdownMenu" class="custom-dropdown-menu" role="menu" aria-labelledby="categoryDropdownBtn"></div>
    </div>
    <!-- Search -->
    <input id="globalSearch" type="text" placeholder="Search" oninput="searchProductsUI(this.value)" class="rounded-full px-4 py-2 bg-white/10 border border-white/10 text-sm outline-none input-glow transition hidden md:block mx-2 min-w-36">
    <i class="fa-solid fa-magnifying-glass cursor-pointer md:hidden ml-1" onclick="toggleMobileSearch()"></i>
    <i class="fa-solid fa-user hover:scale-125 transition cursor-pointer" onclick="showPage('dashboard')"></i>
    <div class="relative cursor-pointer" onclick="toggleModal('cartModal')">
      <i class="fa-solid fa-bag-shopping hover:scale-125 transition"></i>
      <span id="cartCount" class="absolute -top-2 -right-3 text-black text-xs font-bold w-5 h-5 flex items-center justify-center rounded-full transition-all">0</span>
    </div>
  </div>
</nav>

<!-- Search for mobile -->
<div id="mobileSearchBar" class="w-full bg-[#11211b]/95 fixed z-50 left-0 top-16 px-8 py-4 hidden">
  <input id="globalSearchMobile" type="text" placeholder="Search for products..." oninput="searchProductsUI(this.value)" class="w-full rounded-full px-4 py-3 bg-white/10 border border-white/10 outline-none input-glow transition text-lg">
</div>

<!-- Main Pages Container -->
<div id="homePage" class="page">
<!-- Hero -->
<section class="min-h-screen pt-32 pb-20 flex items-center justify-center text-center px-6 relative overflow-hidden">
  <div class="absolute inset-0 bg-gradient-to-b from-[#1a2f28]/50 to-transparent"></div>
  <div class="absolute top-20 left-10 w-72 h-72 bg-[#C2A878]/10 rounded-full blur-[100px]"></div>
  <div class="absolute bottom-20 right-10 w-96 h-96 bg-[#2a4a3f]/30 rounded-full blur-[120px]"></div>
  <div class="max-w-4xl relative z-10 animate-blur">
    <p class="text-[#C2A878] tracking-[0.3em] mb-4 text-sm">PREMIUM PERFORMANCE</p>
    <h1 class="text-5xl md:text-7xl serif font-black mb-6 leading-tight">Engineered for<br/><span class="text-[#C2A878]">Excellence</span></h1>
    <p class="text-gray-400 text-lg md:text-xl max-w-2xl mx-auto mb-10">Precision-crafted athletic wear designed for those who demand more.</p>
    <div class="flex flex-col sm:flex-row gap-4 justify-center">
      <button onclick="document.getElementById('products').scrollIntoView({behavior:'smooth'})" class="btn-gold px-10 py-4 rounded-full text-lg">Shop Collection</button>
      <button class="glass px-10 py-4 rounded-full text-lg hover:bg-white/10 transition" onclick="document.getElementById('aboutSection').scrollIntoView({behavior:'smooth'})">Learn More</button>
    </div>
  </div>
</section>

<!-- Featured -->
<section class="py-20 px-6 flex justify-center">
  <div class="max-w-5xl w-full">
    <div class="glass rounded-3xl p-8 md:p-12 flex flex-col md:flex-row gap-10 items-center">
      <div class="flex-1">
        <p class="text-[#C2A878] tracking-widest text-sm mb-2">FEATURED</p>
        <h2 class="serif text-4xl font-bold mb-4">AeroFlex Hoodie</h2>
        <p class="text-gray-400 mb-6">Our flagship piece. Ultralight stretch material with sweat-resistant technology.</p>
        <div class="flex items-center gap-4 mb-6">
          <span class="text-3xl font-bold">$200</span>
          <span class="text-gray-500 line-through">$250</span>
          <span class="bg-[#C47A3C] text-black text-xs px-3 py-1 rounded-full font-bold">20% OFF</span>
        </div>
        <button onclick="showProductModal('af1')" class="btn-gold px-8 py-4 rounded-full flex items-center gap-3">
          <i class="fa-solid fa-shopping-bag"></i> View Details
        </button>
      </div>
      <div class="flex-1 relative">
        <img src="https://images.unsplash.com/photo-1556821840-3a63f95609a7?w=600&h=600&fit=crop" alt="AeroFlex Hoodie" class="rounded-3xl w-full h-80 object-cover animate-float"/>
      </div>
    </div>
  </div>
</section>

<!-- About -->
<section id="aboutSection" class="py-12 px-6 flex justify-center bg-gradient-to-r from-[#16261f]/80 to-[#141e19]/95">
  <div class="max-w-4xl w-full">
    <h2 class="serif text-3xl font-bold mb-2">About lululemon</h2>
    <p class="text-gray-400 mb-2">lululemon is redefining athletic apparel, fusing high-fashion aesthetics with technology-driven performance. Engineered for those who demand excellence inside and outside the gym.</p>
    <p class="text-gray-500 text-sm">Ethically made in the USA. Backed by science, inspired by ambition, worn by top athletes worldwide.</p>
  </div>
</section>

<!-- Collections Page/Section -->
<section id="collectionsPage" class="page hidden py-20 px-4 flex justify-center min-h-screen">
  <div class="max-w-7xl w-full">
    <div class="mb-12 text-center">
      <h2 class="serif text-4xl font-bold">Collections</h2>
      <p class="text-gray-400 mt-3 mb-6">Shop by category or style.<br>Discover tailored essentials, tech innovation, and the latest in high-performance sportswear.</p>
      <div class="flex flex-wrap justify-center gap-4 mb-8">
        <button class="btn-gold px-8 py-2 rounded-full" onclick="filterCollection('all')">All</button>
        <button class="glass px-8 py-2 rounded-full hover:bg-white/10 transition" onclick="filterCollection('hoodie')">Hoodies</button>
        <button class="glass px-8 py-2 rounded-full hover:bg-white/10 transition" onclick="filterCollection('joggers')">Joggers</button>
        <button class="glass px-8 py-2 rounded-full hover:bg-white/10 transition" onclick="filterCollection('tee')">Tees</button>
        <button class="glass px-8 py-2 rounded-full hover:bg-white/10 transition" onclick="filterCollection('essentials')">Essentials</button>
        <button class="glass px-8 py-2 rounded-full hover:bg-white/10 transition" onclick="filterCollection('limited')">Limited</button>
      </div>
    </div>
    <div class="grid grid-cols-1 md:grid-cols-3 gap-8" id="collectionsGrid"></div>
  </div>
</section>

<!-- Products -->
<section id="products" class="page py-20 px-6 flex justify-center">
  <div class="max-w-6xl w-full">
    <div class="text-center mb-12">
      <p class="text-[#C2A878] tracking-widest text-sm mb-2">SHOP</p>
      <h2 class="serif text-4xl font-bold">The Collection</h2>
    </div>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-8" id="productGrid"></div>
  </div>
</section>

<!-- Reviews -->
<section class="py-20 px-6 flex justify-center bg-gradient-to-b from-transparent via-[#1a2f28]/30 to-transparent">
  <div class="max-w-5xl w-full">
    <div class="text-center mb-12">
      <p class="text-[#C2A878] tracking-widest text-sm mb-2">TESTIMONIALS</p>
      <h2 class="serif text-4xl font-bold">What Athletes Say</h2>
    </div>
    <div class="grid md:grid-cols-3 gap-6">
      <div class="glass p-8 rounded-3xl hover:-rotate-1 hover:-translate-y-2 transition duration-300">
        <div class="flex items-center gap-4 mb-4">
          <div class="w-12 h-12 rounded-full bg-gradient-to-br from-[#C2A878] to-[#8a7355] flex items-center justify-center font-bold text-black">JM</div>
          <div><h4 class="font-bold">Jacob M.</h4><p class="text-gray-500 text-sm">Pro Athlete</p></div>
        </div>
        <p class="text-[#C2A878] mb-3">★★★★★</p>
        <p class="text-gray-300">"The AeroFlex hoodie changed my training forever."</p>
      </div>
      <div class="glass p-8 rounded-3xl hover:rotate-1 hover:-translate-y-2 transition duration-300">
        <div class="flex items-center gap-4 mb-4">
          <div class="w-12 h-12 rounded-full bg-gradient-to-br from-[#C2A878] to-[#8a7355] flex items-center justify-center font-bold text-black">MR</div>
          <div><h4 class="font-bold">Mia R.</h4><p class="text-gray-500 text-sm">Fitness Coach</p></div>
        </div>
        <p class="text-[#C2A878] mb-3">★★★★★</p>
        <p class="text-gray-300">"The material is unreal. Elite feel every day."</p>
      </div>
      <div class="glass p-8 rounded-3xl hover:rotate-1 hover:-translate-y-2 transition duration-300">
        <div class="flex items-center gap-4 mb-4">
          <div class="w-12 h-12 rounded-full bg-gradient-to-br from-[#C2A878] to-[#8a7355] flex items-center justify-center font-bold text-black">TS</div>
          <div><h4 class="font-bold">Tyler S.</h4><p class="text-gray-500 text-sm">CrossFit</p></div>
        </div>
        <p class="text-[#C2A878] mb-3">★★★★☆</p>
        <p class="text-gray-300">"Premium quality that actually performs."</p>
      </div>
    </div>
  </div>
</section>

 
<!-- Footer -->
<footer class="py-16 px-6 border-t border-white/10">
  <div class="max-w-5xl mx-auto grid md:grid-cols-4 gap-10">
    <div><h3 class="serif text-2xl font-bold mb-4">lululemon</h3><p class="text-gray-500 text-sm">Premium performance apparel.</p></div>
    <div><h4 class="font-bold mb-4">Shop</h4><ul class="text-gray-500 space-y-2 text-sm"><li class="hover:text-white cursor-pointer" onclick="showPage('collections')">All Products</li><li class="hover:text-white cursor-pointer" onclick="filterCollection('hoodie');showPage('collections')">Hoodies</li></ul></div>
    <div><h4 class="font-bold mb-4">Company</h4><ul class="text-gray-500 space-y-2 text-sm"><li class="hover:text-white cursor-pointer" onclick="document.getElementById('aboutSection').scrollIntoView({behavior:'smooth'})">About Us</li><li class="hover:text-white cursor-pointer" onclick="showPage('careers')">Careers</li></ul></div>
    <div><h4 class="font-bold mb-4">Connect</h4><div class="flex gap-4 text-xl"><i class="fa-brands fa-instagram hover:text-[#C2A878] cursor-pointer"></i><i class="fa-brands fa-twitter hover:text-[#C2A878] cursor-pointer"></i></div></div>
  </div>
  <p class="text-center text-gray-600 mt-12 text-sm">© 2025 lululemon</p>
</footer>
</div>

<!-- Admin Disclaimer Modal -->
<!-- Careers Page -->
<section id="careersPage" class="page hidden py-20 px-6 flex justify-center min-h-screen">
  <div class="max-w-4xl w-full">
    <div class="text-center mb-8">
      <h2 class="serif text-4xl font-bold">Careers</h2>
      <p class="text-gray-400 mt-3 mb-6">Join the lululemon team — we're building performance apparel for athletes and creators. Below are our open roles. If you don't see a perfect fit, send us a note and your resume.</p>
    </div>

    <div class="grid md:grid-cols-2 gap-6 mb-8">
      <div class="glass p-6 rounded-2xl">
        <h3 class="font-bold text-xl mb-2">Senior Product Designer</h3>
        <div class="text-sm text-gray-300 mb-3">Full-time • Remote (US-friendly)</div>
        <ul class="text-gray-400 list-disc pl-5 mb-3">
          <li>Lead product design across apparel and web experiences</li>
          <li>Collaborate with engineering and merchandising</li>
          <li>Portfolio required; 5+ years experience preferred</li>
        </ul>
        <div class="flex gap-2">
          <button class="btn-gold px-4 py-2 rounded-full" onclick="document.getElementById('applyRole').value='Senior Product Designer';document.getElementById('careersForm').scrollIntoView({behavior:'smooth'})">Apply</button>
          <button class="glass px-4 py-2 rounded-full" onclick="alert('View full description on careers.lululemon (demo)')">Details</button>
        </div>
      </div>

      <div class="glass p-6 rounded-2xl">
        <h3 class="font-bold text-xl mb-2">Merchandising Manager</h3>
        <div class="text-sm text-gray-300 mb-3">Full-time • Hybrid (Los Angeles)</div>
        <ul class="text-gray-400 list-disc pl-5 mb-3">
          <li>Manage product assortments and vendor relations</li>
          <li>Forecasting, replenishment and assortment planning</li>
          <li>3+ years in apparel merchandising or retail</li>
        </ul>
        <div class="flex gap-2">
          <button class="btn-gold px-4 py-2 rounded-full" onclick="document.getElementById('applyRole').value='Merchandising Manager';document.getElementById('careersForm').scrollIntoView({behavior:'smooth'})">Apply</button>
          <button class="glass px-4 py-2 rounded-full" onclick="alert('View full description on careers.lululemon (demo)')">Details</button>
        </div>
      </div>
    </div>

    <div class="glass p-6 rounded-2xl">
      <h3 class="font-bold mb-3">Apply Now</h3>
      <form id="careersForm" class="grid md:grid-cols-2 gap-4" onsubmit="submitCareer(event)">
        <input id="applyRole" name="role" placeholder="Role applying for" class="px-4 py-3 rounded-xl bg-white/6 border border-white/10 input-glow" required />
        <input id="applyName" name="name" placeholder="Full name" class="px-4 py-3 rounded-xl bg-white/6 border border-white/10 input-glow" required />
        <input id="applyEmail" name="email" type="email" placeholder="Email" class="px-4 py-3 rounded-xl bg-white/6 border border-white/10 input-glow" required />
        <input id="applyPhone" name="phone" placeholder="Phone (optional)" class="px-4 py-3 rounded-xl bg-white/6 border border-white/10 input-glow" />
        <textarea id="applyCover" name="cover" placeholder="Cover letter (short)" class="md:col-span-2 px-4 py-3 rounded-xl bg-white/6 border border-white/10 input-glow"></textarea>
        <div class="md:col-span-2 flex gap-3 items-center">
          <input id="applyResume" name="resume" type="file" class="hidden" />
          <button type="button" class="glass px-4 py-2 rounded-full upload-btn" onclick="document.getElementById('applyResume').click()">Upload Resume</button>
          <span id="applyResumeName" class="hidden">No file</span>
          <button type="submit" class="btn-gold px-6 py-3 rounded-full">Submit Application</button>
        </div>
      </form>
      <div id="careersThanks" class="hidden text-green-300 mt-4">Thanks — we've received your application (demo).</div>
    </div>
  </div>
</section>

<div id="adminDisclaimerModal">
  <div class="glass rounded-2xl p-8">
    <h3 class="serif text-2xl font-bold mb-3">Admin Panel — Data Notice</h3>
    <p class="text-gray-300 mb-4">This admin view shows sample metrics and user activity. Do not export or share user data from this demo. All operations here are local and do not transmit user data externally.</p>
    <div class="flex justify-end gap-3">
      <button class="glass px-4 py-2 rounded-full" onclick="closeAdminDisclaimer()">Dismiss</button>
    </div>
  </div>
</div>

<!-- Product Detail Modal -->
<div id="productDetailModal" class="hidden product-detail-modal fixed inset-0 z-[80] bg-black/80 flex items-center justify-center px-2 md:px-9" style="backdrop-filter:blur(6px)" onclick="modalClickOut(event,'productDetailModal')">
  <div class="glass w-full max-w-3xl rounded-3xl p-5 md:p-8 shadow-2xl animate-slide relative flex flex-col md:flex-row gap-8" onclick="event.stopPropagation()">
    <button class="absolute top-5 right-6 text-2xl text-gray-500 hover:text-[#C2A878]" onclick="closeProductModal()"><i class="fa-solid fa-times"></i></button>
    <div class="flex flex-col gap-3 items-center md:items-start md:w-4/12">
      <img id="prodDetailImg" src="" class="rounded-xl mb-2 object-cover w-56 h-56 bg-[#1a2f28] border border-[#C2A878]/30"/>
      <div class="flex gap-1 mt-2" id="prodDetailThumbs"></div>
    </div>
    <div class="flex-1 flex flex-col">
      <h3 id="prodDetailName" class="serif text-2xl font-bold"></h3>
      <p id="prodDetailDesc" class="mb-3 text-gray-400 mt-2"></p>
      <div class="flex items-center gap-5 mb-4">
        <span class="font-bold text-2xl" id="prodDetailPrice"></span>
        <span class="text-gray-400 line-through" id="prodDetailDiscount"></span>
        <span class="bg-[#C47A3C] text-black text-xs px-3 py-1 rounded-full font-bold hidden" id="prodDetailBadge"></span>
      </div>
      <div class="mb-4">
        <div class="mb-2 font-bold text-[#C2A878]">Select Size:</div>
        <div id="prodDetailSizes" class="flex flex-row gap-1"></div>
      </div>
      <div class="mb-4">
        <div class="mb-2 font-bold text-[#C2A878]">Select Color:</div>
        <div id="prodDetailColors" class="flex flex-row items-center"></div>
      </div>
      <div class="mb-5">
        <div class="font-bold mb-1 text-[#C2A878]">Features:</div>
        <ul id="prodDetailFeatures" class="text-gray-400 mb-2 ml-5 list-disc"></ul>
      </div>
      <div class="mb-8">
        <div class="font-bold text-[#C2A878] mb-1">Shipping & Returns:</div>
        <div class="text-gray-400 text-sm" id="prodDetailShipping"></div>
      </div>
      <div class="flex gap-3 items-end">
        <button id="addToCartDetailBtn" class="btn-gold px-8 py-4 rounded-full flex items-center gap-3"><i class="fa-solid fa-cart-plus"></i> Add to Cart</button>
        <span id="prodDetailInCart" class="text-green-300 font-bold hidden ml-2 px-2 py-1 rounded-full bg-green-800/30 text-sm"><i class="fa-solid fa-check mr-1"></i>In cart</span>
      </div>
    </div>
  </div>
</div>
  
<!-- Cart Modal -->
<div id="cartModal" class="fixed inset-0 bg-black/70 backdrop-blur-xl hidden items-center justify-center z-[60]" onclick="closeModalOutside(event,'cartModal')">
  <div class="glass p-6 rounded-none w-full h-full max-w-none mx-0 animate-slide overflow-y-auto flex flex-col" onclick="event.stopPropagation()">
    <div class="flex justify-between items-center mb-6">
      <h2 class="serif text-2xl font-bold">Your Cart</h2>
      <i class="fa-solid fa-times text-xl cursor-pointer hover:text-[#C2A878]" onclick="toggleModal('cartModal')"></i>
    </div>
    <div id="cartItems" class="space-y-4 overflow-y-auto flex-1 mb-6"></div>
    <div id="cartEmpty" class="text-center py-8 text-gray-500">
      <i class="fa-solid fa-bag-shopping text-4xl mb-4 opacity-30"></i>
      <p>Your cart is empty</p>
    </div>
    <div id="cartFooter" class="border-t border-white/10 pt-6">
      <div class="flex justify-between text-lg mb-2"><span>Subtotal</span><span id="cartSubtotal" class="font-bold">$0</span></div>
      <div class="flex justify-between text-sm text-gray-400 mb-2"><span>Shipping (Estimate)</span><span id="cartShipping">$8</span></div>
      <div class="flex justify-between text-sm text-gray-400 mb-2"><span>Returns</span><span>30-day free</span></div>
      <div class="flex justify-between text-lg mb-4"><span>Total</span><span id="cartTotal" class="font-bold">$0</span></div>
      <button onclick="openCheckout()" class="btn-gold w-full py-4 rounded-full mb-3">Checkout</button>
      <button onclick="toggleModal('cartModal')" class="glass w-full py-4 rounded-full hover:bg-white/10 transition">Continue Shopping</button>
    </div>
  </div>
</div>

<!-- Checkout Modal -->
<div id="checkoutModal" class="hidden items-center justify-center" onclick="closeModalOutside(event,'checkoutModal')">
  <div class="checkout-flex-wrapper animate-slide relative" onclick="event.stopPropagation();">
    <div class="flex justify-between items-center mb-6">
      <h2 class="serif text-2xl font-bold">Checkout</h2>
      <i class="fa-solid fa-times text-xl cursor-pointer hover:text-[#C2A878]" onclick="toggleModal('checkoutModal')"></i>
    </div>
    <div class="flex flex-col md:flex-row gap-9">

    <!-- Left (address & payment) -->
    <div class="flex-1 min-w-[250px]">
      <!-- Fulfillment (Shipping / Pickup) -->
      <div class="mb-5">
        <div class="flex items-center gap-2 mb-3">
          <button id="fulfillShippingBtn" onclick="setFulfillment('shipping')" class="px-3 py-2 rounded-full border border-white/10 text-sm tab-active">Shipping</button>
          <button id="fulfillPickupBtn" onclick="setFulfillment('pickup')" class="px-3 py-2 rounded-full border border-white/10 text-sm">Pickup</button>
        </div>
        <!-- Address / Pickup box -->
        <div class="mb-3">
          <div class="flex justify-between items-center mb-2">
            <label id="checkoutAddressLabel" class="font-bold text-[#C2A878]">Shipping Address</label>
            <button onclick="editCheckoutAddress()" class="text-[#C2A878] text-xs hover:underline">Edit</button>
          </div>
          <div id="checkoutAddressBox" class="glass rounded-xl p-4 space-y-2 text-sm"></div>
        </div>
        <!-- Pickup location select (hidden for shipping) -->
        <div id="pickupBox" class="hidden mt-2">
          <label class="text-sm text-gray-400 mb-1 block">Pick up at</label>
          <select id="pickupLocationSelect" class="w-full rounded-xl bg-white/6 border border-white/10 px-3 py-2 text-sm" onchange="onPickupLocationChange(this.value)"></select>
          <div id="pickupHelp" class="text-xs text-gray-400 mt-2">Show ID at pickup. Orders ready in 1-3 hours.</div>
        </div>
      </div>

      <!-- Tip Selector -->
      <div class="mb-6">
        <label class="font-bold text-[#C2A878] mb-2 block">Tip your driver</label>
        <div class="text-gray-400 text-sm mb-2">All tips go to making sure the driver that is getting $0.67 per delivery receives fair compensation.</div>
        <div class="tip-presets mb-3">
          <button type="button" class="tip-btn" onclick="setTip(1)">$1</button>
          <button type="button" class="tip-btn" onclick="setTip(3)">$3</button>
          <button type="button" class="tip-btn" onclick="setTip(5)">$5</button>
          <input id="customTipInput" type="number" min="0" step="0.5" placeholder="$" class="tip-input" oninput="onCustomTipChange(this.value)" />
        </div>
      </div>

      <!-- Credit Card -->
      <div class="flex flex-col gap-2 mb-8">
        <label class="font-bold text-[#C2A878] mb-1">Payment</label>
        <div class="flex justify-center mb-1">
          <div class="card-container">
            <div class="card-inner" id="cardInner">
              <div class="card-front border border-[#C2A878]/30 animate-glow">
                <div class="flex justify-between items-start mb-8">
                  <div class="w-12 h-8 bg-gradient-to-br from-yellow-300 to-yellow-500 rounded"></div>
                  <i class="fa-brands fa-cc-visa text-3xl text-white/80"></i>
                </div>
                <p id="cardNumberDisplay" class="text-xl tracking-[0.2em] mb-6 font-mono">•••• •••• •••• ••••</p>
                <div class="flex justify-between">
                  <div><p class="text-gray-500 text-xs">CARDHOLDER</p><p id="cardNameDisplay" class="text-sm uppercase tracking-wide">YOUR NAME</p></div>
                  <div><p class="text-gray-500 text-xs">EXPIRES</p><p id="cardExpiryDisplay" class="text-sm">MM/YY</p></div>
                </div>
              </div>
              <div class="card-back border border-[#C2A878]/30">
                <div class="w-full h-10 bg-gray-800 rounded mt-6 mb-9"></div>
                <div class="flex justify-end items-center">
                  <div>
                    <p class="text-gray-500 text-xs text-right">CVV</p>
                    <p id="cardCvvDisplay" class="text-right text-sm tracking-widest">•••</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <form id="checkoutForm" onsubmit="submitCheckout(event)">
          <input id="inputCardName" class="w-full px-5 py-3 rounded-xl bg-white/10 border border-white/10 outline-none transition input-glow mb-2" placeholder="Name on Card" maxlength="32" required oninput="updateCardPreview()" autocomplete="cc-name"/>
          <input id="inputCardNumber" class="w-full px-5 py-3 rounded-xl bg-white/10 border border-white/10 outline-none transition input-glow mb-2 font-mono" type="text" inputmode="numeric" autocomplete="cc-number" maxlength="19" placeholder="1234 5678 9012 3456" required oninput="formatAndUpdateCardNumber()"/>
          <div class="flex gap-2">
            <input id="inputCardExpiry" class="px-5 py-3 rounded-xl bg-white/10 border border-white/10 outline-none transition input-glow mb-2 font-mono w-[50%]" type="text" maxlength="5" placeholder="MM/YY" required oninput="formatAndUpdateCardExpiry()"/>
            <input id="inputCardCvv" class="px-5 py-3 rounded-xl bg-white/10 border border-white/10 outline-none transition input-glow mb-2 font-mono w-[50%]" type="password" maxlength="4" placeholder="CVV" required oninput="updateCardPreview()"/>
          </div>
        </form>
      </div>
    </div>
    <!-- Right (summary) -->
    <div class="flex-1 w-full max-w-md">
      <div class="p-4 glass rounded-2xl mb-4">
        <div class="font-bold text-[#C2A878] mb-2">Order Summary</div>
        <div id="checkoutSummaryCart" class="text-sm"></div>
        <div class="border-t border-white/10 my-2"></div>
        <div class="flex justify-between text-lg mb-2"><span>Subtotal</span><span id="checkoutSubtotal" class="font-bold">$0</span></div>
          <div class="flex justify-between text-sm text-gray-400 mb-2"><span id="checkoutShippingLabel">Shipping (Flat)</span><span id="checkoutShippingAmount">$8.00</span></div>
          <div class="flex justify-between text-sm text-gray-400 mb-2"><span>Tip</span><span id="checkoutTipAmount">$0.00</span></div>
        <div class="flex justify-between text-sm text-gray-400 mb-2"><span>Returns</span><span>30-day free</span></div>
        <div class="flex justify-between text-lg"><span>Total</span><span id="checkoutTotal" class="font-bold">$0</span></div>
      </div>
      <div class="rounded-2xl bg-[#191f17]/80 border border-[#C2A878]/30 px-5 py-4 mb-3 text-xs text-gray-300"><span class="font-bold text-[#C2A878]">Shipping Policy:</span> Free shipping above $250. <br><span class="font-bold text-[#C2A878]">Returns:</span> 30-day easy returns, no questions asked.</div>
      <button form="checkoutForm" type="submit" class="btn-gold w-full py-4 rounded-full mt-2">Pay Now</button>
      <button type="button" onclick="toggleModal('checkoutModal')" class="glass w-full py-3 rounded-full mt-2 hover:bg-white/10 transition">Cancel</button>
      <div id="checkoutSuccess" class="hidden text-center py-12 animate-success mt-4">
        <i class="fa-solid fa-circle-check text-5xl text-[#C2A878] mb-4"></i>
        <h3 class="serif text-2xl font-bold mb-4">Payment Successful!</h3>
        <p class="text-gray-300 mb-6">Thank you for your purchase. You have earned <span id="loyaltyEarnings" class="text-[#C2A878] font-bold">0</span> reward points.</p>
        <button onclick="closeCheckoutModal()" class="btn-gold px-8 py-4 rounded-full">Continue Shopping</button>
      </div>
    </div>
    </div>
  </div>
</div>

<!-- Dashboard Page -->
<div id="dashboardPage" class="page hidden pt-24 pb-20 px-6 min-h-screen">
  <div class="max-w-5xl mx-auto">
    <div class="flex items-center justify-between mb-8">
      <div>
        <h1 class="serif text-4xl font-bold">My Account</h1>
        <p class="text-gray-400" id="dashboardWelcome">Welcome back, ...</p>
      </div>
      <button onclick="showPage('home')" class="glass px-6 py-3 rounded-full hover:bg-white/10 transition">
        <i class="fa-solid fa-arrow-left mr-2"></i>Back to Shop
      </button>
    </div>
    
    <!-- Dashboard Tabs -->
    <div class="flex gap-2 mb-8 flex-wrap">
      <button onclick="showTab('orders')" id="tab-orders" class="px-6 py-3 rounded-full border border-white/20 transition tab-active">Orders</button>
      <button onclick="showTab('addresses')" id="tab-addresses" class="px-6 py-3 rounded-full border border-white/20 transition">Addresses</button>
      <button onclick="showTab('cards')" id="tab-cards" class="px-6 py-3 rounded-full border border-white/20 transition">Payment</button>
      <button onclick="showTab('admin')" id="tab-admin" class="px-6 py-3 rounded-full border border-white/20 transition">Admin</button>
      <button onclick="showTab('loyalty')" id="tab-loyalty" class="px-6 py-3 rounded-full border border-white/20 transition">Loyalty & Rewards</button>
      <button onclick="showTab('settings')" id="tab-settings" class="px-6 py-3 rounded-full border border-white/20 transition">Settings</button>
    </div>
    
    <!-- Orders Tab -->
    <div id="panel-orders" class="space-y-4">
      <div id="orderList"></div>
    </div>
    
    <!-- Addresses Tab -->
    <div id="panel-addresses" class="hidden grid md:grid-cols-2 gap-4"></div>
    
    <!-- Cards Tab -->
    <div id="panel-cards" class="hidden grid md:grid-cols-2 gap-4"></div>
    
    <!-- Loyalty Tab -->
    <div id="panel-loyalty" class="hidden">
      <div class="glass rounded-2xl p-6 flex flex-col md:flex-row gap-8 items-center">
        <div class="flex-1 flex flex-col items-center md:items-start">
          <div class="font-bold text-[#C2A878] text-3xl mb-1" id="loyaltyPoints">0</div>
          <div class="font-bold text-base mb-2 text-orange-300" id="loyaltyCredit"></div>
          <div class="text-gray-500 mb-1 text-xs">Total rewards</div>
          <div class="text-green-200 text-sm mb-3">Refer a friend and earn more!</div>
        </div>
        <div class="flex-1">
          <div class="font-bold text-[#C2A878] mb-1">Recent Activity</div>
          <ul id="loyaltyHistory" class="text-sm space-y-2 list-disc pl-6"></ul>
        </div>
      </div>
    </div>

    <!-- Settings Tab -->
    <div id="panel-settings" class="hidden">
      <div class="glass rounded-2xl p-6 space-y-6">
        <div>
          <label class="text-gray-400 text-sm block mb-2">Full Name</label>
          <input id="settingsName" class="w-full px-5 py-4 rounded-xl bg-white/10 border border-white/10 outline-none focus:border-[#C2A878] input-glow transition"/>
        </div>
        <div>
          <label class="text-gray-400 text-sm block mb-2">Email</label>
          <input id="settingsEmail" class="w-full px-5 py-4 rounded-xl bg-white/10 border border-white/10 outline-none focus:border-[#C2A878] input-glow transition"/>
        </div>
        <div>
          <label class="text-gray-400 text-sm block mb-2">Phone</label>
          <input id="settingsPhone" class="w-full px-5 py-4 rounded-xl bg-white/10 border border-white/10 outline-none focus:border-[#C2A878] input-glow transition"/>
        </div>
        <button class="btn-gold px-8 py-4 rounded-full" onclick="saveProfileSettings()">Save Changes</button>
      </div>
    </div>
    <!-- Admin Tab -->
    <div id="panel-admin" class="hidden">
      <div class="grid md:grid-cols-3 gap-6 mb-6">
        <div class="glass p-6 rounded-2xl">
          <div class="text-sm text-gray-400">Gross Revenue</div>
          <div id="adminGross" class="text-2xl font-bold text-[#C2A878]">$0</div>
        </div>
        <div class="glass p-6 rounded-2xl">
          <div class="text-sm text-gray-400">Returns / Losses</div>
          <div id="adminLoss" class="text-2xl font-bold text-red-400">$0</div>
        </div>
        <div class="glass p-6 rounded-2xl">
          <div class="text-sm text-gray-400">Total Orders</div>
          <div id="adminOrdersCount" class="text-2xl font-bold text-[#C2A878]">0</div>
        </div>
      </div>

      <div class="mb-6 grid md:grid-cols-2 gap-6">
        <div class="glass p-6 rounded-2xl">
          <div class="flex items-center justify-between mb-4">
            <h3 class="font-bold">Users</h3>
            <div style="min-width:220px;max-width:420px;width:40%">
              <input id="adminUserSearch" oninput="searchUsers(this.value)" placeholder="Search users..." class="admin-search-input" />
            </div>
          </div>
          <div id="adminUsersTable" class="max-h-64 overflow-y-auto"></div>
        </div>
        <div class="glass p-6 rounded-2xl">
          <h3 class="font-bold mb-3">Top Products</h3>
          <div id="adminTopProducts" class="space-y-3"></div>
          <div class="border-t border-white/10 mt-4 pt-3">
            <h4 class="font-bold mb-2">Recent Returns</h4>
            <div id="adminReturns" class="text-sm text-gray-300"></div>
          </div>
          <div class="border-t border-white/10 mt-4 pt-3">
            <h4 class="font-bold mb-2">Rewards Given</h4>
            <div id="adminRewards" class="text-lg font-bold text-[#C2A878]">$0</div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Floating FAQ & Support Button -->
    <div id="supportFab" class="support-fab" onclick="openSupportModal()" title="Chat with us">
      <i id="supportFabIcon" class="fa-solid fa-comments text-2xl text-[#1a2f28]"></i>
    </div>
<!-- Support Modal -->
<div id="supportModal" class="fixed inset-0 bg-black/70 z-[120] hidden flex items-center justify-center" onclick="closeModalOutside(event,'supportModal')">
  <div class="glass rounded-3xl p-8 max-w-lg w-full relative animate-slide" onclick="event.stopPropagation()">
    <button class="absolute top-5 right-6 text-2xl text-gray-500 hover:text-[#C2A878]" onclick="toggleModal('supportModal')"><i class="fa-solid fa-times"></i></button>
    <h2 class="serif text-2xl font-bold mb-3">Help & Support</h2>
    <div class="flex gap-3 mb-5">
      <button id="faqTabBtn" class="glass px-4 py-2 rounded-full tab-active" onclick="showSupportTab('faq')">FAQ</button>
      <button id="chatTabBtn" class="glass px-4 py-2 rounded-full" onclick="showSupportTab('chat')">Chat</button>
    </div>
    <div id="faqTab">
      <div class="mb-5">
        <div class="faq-q" onclick="toggleFaq(this)">How long does shipping take?</div>
        <div class="faq-a">Domestic orders: 2-5 business days. International: 7-14 days.</div>
        <div class="faq-q" onclick="toggleFaq(this)">What is your return policy?</div>
        <div class="faq-a">You can return any product within 30 days for a full refund, no questions asked.</div>
        <div class="faq-q" onclick="toggleFaq(this)">How can I contact support?</div>
        <div class="faq-a">Chat here or email <span class="lowercase">support@lululemon.example</span>. Our team responds in under 12 hours!</div>
        <div class="faq-q" onclick="toggleFaq(this)">How do loyalty points work?</div>
        <div class="faq-a">Earn 1 point per $1 spent. 100 points = $10 store credit, redeemable at checkout!</div>
      </div>
      <form id="supportForm" class="flex flex-col gap-3">
        <label class="text-[#C2A878] font-bold">Contact Us</label>
        <input type="text" class="px-4 py-2 rounded bg-white/10 border border-[#C2A878]/40 input-glow" placeholder="Your Email" required/>
        <textarea class="px-4 py-2 rounded bg-white/10 border border-[#C2A878]/40 input-glow" placeholder="Message" required></textarea>
        <button type="submit" class="btn-gold px-6 py-3 rounded-full">Send Message</button>
      </form>
      <div id="supportThank" class="hidden py-6 text-center text-[#C2A878] text-lg font-bold">Thank you, we'll get back to you soon!</div>
    </div>
    <div id="chatTab" style="display:none">
      <div id="chatArea" class="flex flex-col gap-3" style="height:320px;">
        <div id="chatMessages" class="overflow-y-auto p-3 rounded-xl bg-[#08120f] border border-white/6 flex-1" style="min-height:120px"></div>
        <div class="flex gap-2 mt-2">
          <input id="chatInput" type="text" placeholder="Ask me about shipping, sizes, pickup..." class="flex-1 px-3 py-2 rounded-xl bg-white/6 border border-white/10 input-glow chat-input"/>
          <button id="chatSendBtn" class="btn-gold px-4 py-2 rounded-xl">Send</button>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
//----------------------- FAKE DATA --------------------------
const userInitial = {
  name: "Alex Johnson",
  email: "alex.johnson21@mail.com",
  phone: "+1 562-401-8891",
  addresses: [
    {
      id: "home",
      label: "Home",
      name: "Alex Johnson",
      street: "823 Elmwood Rd",
      city: "Long Beach, CA 90805",
      country: "United States",
      phone: "+1 562-401-8891",
      isDefault: true
    },
    {
      id: "work",
      label: "Work",
      name: "Alex Johnson",
      street: "700 S Flower St, Fl 25",
      city: "Los Angeles, CA 90017",
      country: "United States",
      phone: "+1 323-777-1234",
      isDefault: false
    },
    {
      id: "gym",
      label: "Gym",
      name: "Alex Johnson",
      street: "24/7 Fit, 1337 Sunset Blvd",
      city: "Los Angeles, CA 90026",
      country: "United States",
      phone: "+1 213-400-1999",
      isDefault: false
    }
  ],
  cards: [
    {
      id: "visalast",
      brand: "Visa",
      last: "4242",
      holder: "ALEX JOHNSON",
      exp: "12/27",
      isDefault: true
    },
    {
      id: "mc8888",
      brand: "Mastercard",
      last: "8888",
      holder: "ALEX JOHNSON",
      exp: "08/26",
      isDefault: false
    }
  ],
  orders: [
    {
      n: "#BZ-10721",
      date: "Nov 15, 2025",
      status: "Delivered",
      statusColor: "green",
      items: [
        {
          name: "AeroFlex Hoodie",
          img: "https://images.unsplash.com/photo-1556821840-3a63f95609a7?w=100&h=100&fit=crop",
          detail: "Size: M • Color: Black",
          qty: 1,
          price: 200
        }
      ],
      total: 200
    },
    {
      n: "#BZ-10699",
      date: "Oct 24, 2025",
      status: "Shipped",
      statusColor: "blue",
      items: [
        {
          name: "Stealth Joggers",
          img: "https://images.unsplash.com/photo-1552902865-b72c031ac5ea?w=100&h=100&fit=crop",
          detail: "Size: L • Color: Charcoal",
          qty: 2,
          price: 180
        },
        {
          name: "Glide Tee",
          img: "https://images.unsplash.com/photo-1521572163474-6864f9cf17ab?w=100&h=100&fit=crop",
          detail: "Size: L • Color: Arctic",
          qty: 1,
          price: 120
        }
      ],
      total: 480
    }
  ],
  loyalty: {
    points: 2134,
    credit: "$200.00",
    history: [
      "+500 pts — Order #BZ-10721<br><span class='text-gray-400'>Nov 15, 2025</span>",
      "+1000 pts — Referral Bonus<br><span class='text-gray-400'>Nov 10, 2025</span>",
      "+200 pts — Order #BZ-10699<br><span class='text-gray-400'>Oct 24, 2025</span>",
      "+40 pts — Birthday Gift<br><span class='text-gray-400'>Oct 12, 2025</span>"
    ]
  }
};

// ----- Fake user data for admin dashboard -----
const fakeUsers = [
  { id:'u1', name:'Alex Johnson', email:'alex.johnson21@mail.com', rewardsGiven:50, orders:[{n:'#BZ-10721',date:'2025-11-15',items:[{id:'af1',qty:1,price:200}], total:200, status:'Pending'}], returns:[] },
  { id:'u2', name:'Mia Rodriguez', email:'mia.r@example.com', rewardsGiven:30, orders:[{n:'#BZ-10501',date:'2025-10-11',items:[{id:'sj2',qty:2,price:180}], total:360, status:'Pending'}], returns:[{order:'#BZ-10501',amount:180,reason:'Size issue', explanation:''}] },
  { id:'u3', name:'Jacob Miller', email:'jacob.m@example.com', rewardsGiven:10, orders:[{n:'#BZ-10700',date:'2025-11-10',items:[{id:'gt3',qty:1,price:120},{id:'pv4',qty:1,price:220}], total:340, status:'Completed'}], returns:[] },
  { id:'u4', name:'Emma Stone', email:'emma.s@example.com', rewardsGiven:20, orders:[{n:'#BZ-10650',date:'2025-09-29',items:[{id:'tv6',qty:1,price:140}], total:140, status:'Pending'}], returns:[{order:'#BZ-10650',amount:140,reason:'Defect', explanation:''}] }
];

const products = [
  {
    id: 'af1',
    name: 'AeroFlex Hoodie',
    desc: "Our flagship piece. Ultralight stretch material with sweat-wicking tech. Minimalist, premium fit. Unisex tailored cut.",
    collection: "hoodie essentials",
    price: 200,
    origPrice: 250,
    badge: "20% OFF",
    img: "https://images.unsplash.com/photo-1556821840-3a63f95609a7?w=500&h=500&fit=crop",
    thumbs: [
      "https://images.unsplash.com/photo-1556821840-3a63f95609a7?w=450&h=450&fit=crop",
      "https://images.unsplash.com/photo-1556810367-1ebbe37b6c61?w=450&h=450&fit=crop",
      "https://images.unsplash.com/photo-1464983953574-0892a716854b?w=450&h=450&fit=crop"
    ],
    features: ["Featherweight nylon blend", "Sweatproof tech", "Hidden pocket", "Ergonomic sleeves"],
    shipping: "Ships in 2-4 days. Free returns within 30 days.",
    sizes: ["S","M","L","XL"],
    colors: [
      { color: "#161718", label: "Black" },
      { color: "#c2a878", label: "Gold" },
      { color: "#d3e7f2", label: "Arctic" }
    ]
  },
  {
    id: 'sj2',
    name: 'Stealth Joggers',
    desc: "Performance blended joggers for elite mobility and comfort. Reinforced seams, taper fit.",
    collection: "joggers essentials",
    price: 180,
    origPrice: 180,
    img: "https://images.unsplash.com/photo-1552902865-b72c031ac5ea?w=500&h=500&fit=crop",
    thumbs: [
      "https://images.unsplash.com/photo-1552902865-b72c031ac5ea?w=450&h=450&fit=crop"
    ],
    badge: "",
    features: ["4-way stretch", "Quick-dry", "Zippered pockets", "No-pinch waistband"],
    shipping: "In stock. 2-5 day US shipping.",
    sizes: ["S","M","L","XL","XXL"],
    colors: [
      { color: "#353438", label: "Charcoal" },
      { color: "#231f20", label: "Blackout" }
    ]
  },
  {
    id: 'gt3',
    name: 'Glide Tee',
    desc: "Ultra-smooth technical tee. Breathable, odor-resistant fabric. Regular/relaxed fit.",
    collection: "tee essentials limited",
    price: 120,
    origPrice: 120,
    badge: "LIMITED",
    img: "https://images.unsplash.com/photo-1521572163474-6864f9cf17ab?w=500&h=500&fit=crop",
    thumbs: [
      "https://images.unsplash.com/photo-1521572163474-6864f9cf17ab?w=450&h=450&fit=crop",
      "https://images.unsplash.com/photo-1465101046530-73398c7f28ca?w=450&h=450&fit=crop"
    ],
    features: ["Anti-odor", "Breathable mesh", "No tags", "Relaxed fit"],
    shipping: "Ships in 24 hours. Free return label.",
    sizes: ["XS","S","M","L","XL","XXL"],
    colors: [
      { color: "#dde6ed", label: "Arctic" },
      { color: "#21231e", label: "Midnight" },
      { color: "#b1c6d4", label: "Cloud" }
    ]
  }
  ,
  {
    id: 'pv4',
    name: 'Pulse Hoodie',
    desc: 'Lightweight thermal hoodie with reflective trims and breathable mesh panels.',
    collection: 'hoodie limited',
    price: 220,
    origPrice: 260,
    badge: 'NEW',
    img: 'https://images.unsplash.com/photo-1541099649105-f69ad21f3246?w=500&h=500&fit=crop',
    thumbs: [
      'https://images.unsplash.com/photo-1541099649105-f69ad21f3246?w=450&h=450&fit=crop'
    ],
    features: ['Thermal lining','Reflective trim','Breathable back panel','Athletic fit'],
    shipping: 'Ships in 2-4 business days.',
    sizes: ['S','M','L','XL'],
    colors: [ {color:'#161718',label:'Black'}, {color:'#9fb2c8',label:'Steel'} ]
  },
  {
    id: 'as5',
    name: 'AeroFlex Shorts',
    desc: 'Fast-dry running shorts with inner liner and zip pocket for keys.',
    collection: 'shorts essentials',
    price: 80,
    origPrice: 80,
    badge: '',
    img: 'https://images.unsplash.com/photo-1520975914567-4b6b8b5d4f5a?w=500&h=500&fit=crop',
    thumbs: [ 'https://images.unsplash.com/photo-1520975914567-4b6b8b5d4f5a?w=450&h=450&fit=crop' ],
    features: ['Inner liner','Key zip pocket','Moisture wicking'],
    shipping: 'In stock. Ships in 1-3 days.',
    sizes: ['XS','S','M','L','XL'],
    colors: [ {color:'#2b2b2b',label:'Charcoal'}, {color:'#c2a878',label:'Gold'} ]
  },
  {
    id: 'tv6',
    name: 'TrailWind Vest',
    desc: 'Windproof, packable vest designed for trail runs and outdoor workouts.',
    collection: 'vest limited',
    price: 140,
    origPrice: 160,
    badge: '',
    img: 'https://images.unsplash.com/photo-1503342452485-86f7a8710b0f?w=500&h=500&fit=crop',
    thumbs: [ 'https://images.unsplash.com/photo-1503342452485-86f7a8710b0f?w=450&h=450&fit=crop' ],
    features: ['Packable','Windproof membrane','Reflective accents'],
    shipping: 'Ships in 2-4 days. Free returns.',
    sizes: ['S','M','L','XL'],
    colors: [ {color:'#243023',label:'Olive'}, {color:'#121212',label:'Black'} ]
  }
];

//----------------------- LOCAL STORAGE PROFILE --------------------------
function getProfile(){
  let profile = localStorage.getItem("apparelProfile");
  if(!profile){
    localStorage.setItem("apparelProfile",JSON.stringify(userInitial));
    return {...userInitial};
  }
  try { return JSON.parse(profile); }
  catch { localStorage.removeItem("apparelProfile"); return {...userInitial}; }
}
function setProfile(p){
  localStorage.setItem("apparelProfile",JSON.stringify(p));
}
let profile = getProfile();

//----------------------- PRODUCTS LOAD & SEARCH/FILTER ------------------
function loadProducts(prodList=products){
  const grid = document.getElementById('productGrid');
  grid.innerHTML = '';
  prodList.forEach(p=>{
    grid.innerHTML += `
      <div class="product-card glass p-0 rounded-2xl group cursor-pointer shadow transition" data-id="${p.id}" onclick='showProductModal("${p.id}")'>
        <div class="inner p-5">
          <div class="product-image-wrap mb-4">
            <img src="${p.img}" alt="${p.name}" class="rounded-lg" />
            ${p.badge? `<div class="product-badge">${p.badge}</div>`:``}
            <div class="product-overlay">
              <div>
                <div class="product-name serif text-base">${p.name}</div>
                <div class="text-xs text-gray-300">${p.collection? p.collection.split(' ')[0] : ''}</div>
              </div>
              <div class="flex items-center gap-2">
                <div class="price-pill">$${p.price}${p.price!==p.origPrice?` <span class="text-xs line-through ml-2">$${p.origPrice}</span>`:''}</div>
                <button class="btn-small" onclick="event.stopPropagation();addToCart(${JSON.stringify(p).replace(/'/g,"\'")},true)">Add</button>
              </div>
            </div>
          </div>
          <div class="px-1 text-center">
            <p class="text-gray-400 text-sm mb-3">${p.desc.slice(0,80).replace(/\.$/,'')}...</p>
            <div class="flex justify-center gap-3">
              <button class="glass px-5 py-2 rounded-full hover:bg-white/10 transition text-sm" onclick="event.stopPropagation();showProductModal('${p.id}')">View</button>
              <button class="btn-gold px-5 py-2 rounded-full" onclick="event.stopPropagation();addToCart(${JSON.stringify(p).replace(/'/g,"\\'")},true)">Buy</button>
            </div>
          </div>
        </div>
      </div>
    `;
  });
}
  loadProducts();
  populateCategorySelect();
// Search bar quick filter
function searchProductsUI(q){
  q = (q||'').trim().toLowerCase();
  let prods = products.filter(p => 
    p.name.toLowerCase().includes(q) || p.desc.toLowerCase().includes(q) || (p.collection||"").includes(q));
  loadProducts(prods);
  loadCollectionsGrid(prods);
}
function toggleMobileSearch(){
  let bar=document.getElementById('mobileSearchBar');
  bar.classList.toggle('hidden');
  if(!bar.classList.contains('hidden')){
    setTimeout(()=>document.getElementById('globalSearchMobile').focus(),100);
  }
}
document.addEventListener("keydown",e=>{if(e.key==="Escape")document.getElementById('mobileSearchBar').classList.add('hidden')});

//---- COLLECTION SECTION ----
function showPage(page){
  try{
    console.log('showPage called for',page);
    const pages = [ 'homePage','collectionsPage','dashboardPage','careersPage' ];
    const targetId = page==='home' ? 'homePage' : page==='collections' ? 'collectionsPage' : page==='dashboard' ? 'dashboardPage' : page==='careers' ? 'careersPage' : 'homePage';
    const target = document.getElementById(targetId);
    if(!target){ console.warn('showPage: target not found',targetId); document.getElementById('homePage')?.classList.remove('hidden','page-hidden'); return; }

    // find currently visible page
    const current = pages.map(id=>document.getElementById(id)).find(el=>el && !el.classList.contains('hidden') && !el.classList.contains('page-hidden'));

    // animate current out
    if(current && current !== target){
      current.classList.add('page-leave');
      // after leave animation, hide the element
      setTimeout(()=>{
        current.classList.add('hidden','page-hidden');
        current.classList.remove('page-leave','page-enter');
      },320);
    }

    // prepare target
    target.classList.remove('hidden','page-hidden');
    // give a small delay so the browser registers the unhide, then animate enter
    requestAnimationFrame(()=>{
      target.classList.add('page-enter');
      // remove enter class after animation to keep state clean
      setTimeout(()=>target.classList.remove('page-enter'),500);
    });

    // If the careers page appears but has no visible height/content (some envs), add a small fallback
    if(page==='careers'){
      setTimeout(()=>{
        try{
          const rect = target.getBoundingClientRect();
          const textLen = (target.innerText||'').trim().length;
          console.log('careers rect height',rect.height,'textLen',textLen);
          if(rect.height < 40 || textLen < 10){
            // append a visible fallback message without clobbering existing content
            const fb = document.createElement('div');
            fb.className = 'glass p-6 rounded-2xl text-center';
            fb.style.marginTop = '12px';
            fb.innerHTML = '<strong class="text-[#C2A878]">Careers (demo)</strong><div class="text-gray-300 mt-2">If content is not visible in your environment, this is a demo placeholder. The full Careers content remains in the file.</div>';
            // remove any previous fallback
            const prev = target.querySelector('.careers-fallback'); if(prev) prev.remove(); fb.classList.add('careers-fallback');
            target.appendChild(fb);
          }
        }catch(e){console.warn('careers fallback check error',e)}
      },420);
    }

    // Reset search, close modals
    document.getElementById('mobileSearchBar')?.classList.add('hidden');
    window.scrollTo(0,0);
    if(page==='collections')loadCollectionsGrid();
    if(page==='dashboard')renderDashboard();
    // show debug overlay if present
    try{
      const dbg = document.getElementById('pageDebug');
      if(dbg){ dbg.textContent = page; dbg.style.display='block'; clearTimeout(dbg._t); dbg._t = setTimeout(()=>dbg.style.display='none',900); }
    }catch(e){}
    if(page==='careers'){ console.log('Navigated to careers'); }
  }catch(err){
    console.error('showPage error',err);
    // fallback: ensure home is visible
    document.getElementById('homePage')?.classList.remove('hidden','page-hidden');
  }
}
// Careers form handler (demo)
function submitCareer(e){
  e.preventDefault();
  const name = document.getElementById('applyName')?.value || '';
  const email = document.getElementById('applyEmail')?.value || '';
  // simple validation
  if(!name || !email){ alert('Please enter name and email'); return; }
  // simulate upload/submit
  document.getElementById('careersForm').classList.add('opacity-60');
  setTimeout(()=>{
    document.getElementById('careersForm').reset();
    document.getElementById('careersThanks').classList.remove('hidden');
    document.getElementById('careersForm').classList.remove('opacity-60');
  },800);
}

// show selected resume filename next to Upload button
try{
  const _resumeEl = document.getElementById('applyResume');
  if(_resumeEl){
    _resumeEl.addEventListener('change', (ev)=>{
      const nameSpan = document.getElementById('applyResumeName');
      if(!nameSpan) return;
      const f = ev.target.files && ev.target.files[0];
      if(f){ nameSpan.textContent = f.name; nameSpan.classList.remove('hidden'); }
      else { nameSpan.textContent = ''; nameSpan.classList.add('hidden'); }
    });
  }
}catch(e){console.warn('resume name bind failed',e)}
function filterCollection(cat){
  let filtered = cat==="all"
    ? products
    : products.filter(p => (p.collection||"").includes(cat.toLowerCase()));
  loadCollectionsGrid(filtered);
  // keep product grid in sync
  try{ loadProducts(filtered); }catch(e){}
  return filtered;
}
// collections grid is the same as product but allows more categories
function loadCollectionsGrid(prods=products){
  let grid=document.getElementById('collectionsGrid');
  grid.innerHTML='';
  prods.forEach(p=>{
    grid.innerHTML += `
      <div class="product-card glass p-0 rounded-2xl group cursor-pointer shadow transition" data-id="${p.id}" onclick='showProductModal("${p.id}")'>
        <div class="inner p-4">
          <div class="product-image-wrap mb-3">
            <img src="${p.img}" alt="${p.name}" class="rounded-lg" />
            ${p.badge? `<div class="product-badge">${p.badge}</div>`:``}
            <div class="product-overlay">
              <div>
                <div class="product-name serif text-sm">${p.name}</div>
                <div class="text-xs text-gray-300">${p.collection? p.collection.split(' ')[0] : ''}</div>
              </div>
              <div class="flex items-center gap-2">
                <div class="price-pill">$${p.price}${p.price!==p.origPrice?` <span class="text-xs line-through ml-2">$${p.origPrice}</span>`:''}</div>
                <button class="btn-small" onclick="event.stopPropagation();addToCart(${JSON.stringify(p).replace(/'/g,"\\'")},true)">Add</button>
              </div>
            </div>
          </div>
          <div class="px-1 text-center">
            <p class="text-gray-400 text-sm mb-3">${p.desc.slice(0,72).replace(/\.$/,'')}...</p>
          </div>
        </div>
      </div>
    `;
  });
}

// -------------------- (removed Projects area) --------------------


//---- PRODUCT DETAILS MODAL ----
let prodDetail = {};
function showProductModal(id){
  prodDetail = products.find(p=>p.id===id);
  if(!prodDetail)return;
  let i0=0;
  document.getElementById('prodDetailImg').src=prodDetail.thumbs[0]||prodDetail.img;
  document.getElementById('prodDetailName').innerText=prodDetail.name;
  document.getElementById('prodDetailDesc').innerText=prodDetail.desc;
  document.getElementById('prodDetailPrice').innerText=`$${prodDetail.price}`;
  document.getElementById('prodDetailDiscount').innerText = prodDetail.price!==prodDetail.origPrice? `$${prodDetail.origPrice}`: '';
  document.getElementById('prodDetailBadge').classList.toggle('hidden',!prodDetail.badge);
  document.getElementById('prodDetailBadge').innerText=prodDetail.badge;
  document.getElementById('prodDetailFeatures').innerHTML = prodDetail.features.map(s=>`<li>${s}</li>`).join('');
  document.getElementById('prodDetailShipping').innerText=prodDetail.shipping;
  // Thumbnails
  let thumbs = document.getElementById('prodDetailThumbs');
  thumbs.innerHTML='';
  (prodDetail.thumbs||[prodDetail.img]).forEach((t,i)=>{
    thumbs.innerHTML+=`<img src="${t}" class="thumb ${i==0?"selected":""}" onclick="switchModalThumb(${i})"/>`
  })
  // Sizes
  let sizesBox=document.getElementById('prodDetailSizes');
  sizesBox.innerHTML = prodDetail.sizes.map(size=>`<button class="size-btn" data-size="${size}" onclick="selectModalSize('${size}',this)">${size}</button>`).join('');
  // Colors
  let colorsBox=document.getElementById('prodDetailColors');
  colorsBox.innerHTML = prodDetail.colors.map((col,i)=>`<span class="color-dot" style="background:${col.color}" title="${col.label}" onclick="selectModalColor('${i}',this)"></span>`).join('');
  // Summary for shipping/returns already filled.
  // Add to cart setup
  window.modalSize=null,window.modalColor=null;
  document.getElementById('addToCartDetailBtn').onclick = ()=>addToCart(prodDetail,true);
  document.getElementById('prodDetailInCart').classList.toggle('hidden',!cart.some(c=>c.id==prodDetail.id));
  document.getElementById('productDetailModal').classList.remove('hidden');
}
function closeProductModal(){
  document.getElementById('productDetailModal').classList.add('hidden');
}
function modalClickOut(e,id){if(e.target.id===id)closeProductModal();}
function switchModalThumb(i){
  document.getElementById('prodDetailImg').src=prodDetail.thumbs[i];
  [...document.querySelectorAll('#prodDetailThumbs .thumb')].forEach((el,idx)=>el.classList.toggle('selected',idx===i));
}
function selectModalSize(size,btn){
  window.modalSize = size;
  [...btn.parentElement.children].forEach(b=>b.classList.remove('selected'));
  btn.classList.add('selected');
}
function selectModalColor(idx,el){
  window.modalColor = prodDetail.colors[parseInt(idx)];
  [...el.parentElement.children].forEach(e=>e.classList.remove('selected'));
  el.classList.add('selected');
}

// Populate category select from products (first token of collection)
function populateCategorySelect(){
  try{
    const sel = document.getElementById('categorySelect');
    const cats = new Set();
    products.forEach(p=>{
      if(p.collection){
        const first = p.collection.split(' ')[0].toLowerCase();
        cats.add(first);
      }
    });
    // populate hidden native select (fallback)
    Array.from(cats).sort().forEach(c=>{
      const opt = document.createElement('option'); opt.value=c; opt.textContent = c.charAt(0).toUpperCase()+c.slice(1);
      sel.appendChild(opt);
    });

    // populate custom dropdown menu
    const dd = document.getElementById('categoryDropdown');
    const menu = document.getElementById('categoryDropdownMenu');
    const label = document.getElementById('categoryDropdownLabel');
    if(menu && dd){
      menu.innerHTML = '';
      // add All
      const allItem = document.createElement('div');
      allItem.className = 'custom-dropdown-item active';
      allItem.textContent = 'All';
      allItem.dataset.value = 'all';
      allItem.onclick = ()=>selectCategory('all');
      menu.appendChild(allItem);
      Array.from(cats).sort().forEach(c=>{
        const it = document.createElement('div');
        it.className = 'custom-dropdown-item';
        it.textContent = c.charAt(0).toUpperCase()+c.slice(1);
        it.dataset.value = c;
        it.onclick = ()=>selectCategory(c);
        menu.appendChild(it);
      });
      dd.classList.remove('hidden');
      // wire button
      const btn = document.getElementById('categoryDropdownBtn');
      btn.onclick = (e)=>{ e.stopPropagation(); dd.classList.toggle('open'); dd.setAttribute('aria-expanded', String(dd.classList.contains('open'))); };
      // close on outside
      document.addEventListener('click', (e)=>{ if(!dd.contains(e.target)) { dd.classList.remove('open'); dd.setAttribute('aria-expanded','false'); } });
      document.addEventListener('keydown', (e)=>{ if(e.key==='Escape'){ dd.classList.remove('open'); dd.setAttribute('aria-expanded','false'); } });
    }
  }catch(e){console.warn('populateCategorySelect error',e)}
}

function selectCategory(val){
  const dd = document.getElementById('categoryDropdown');
  const menu = document.getElementById('categoryDropdownMenu');
  const label = document.getElementById('categoryDropdownLabel');
  // update active item
  [...menu.children].forEach(ch=>ch.classList.toggle('active', ch.dataset.value===val));
  // update label and hidden select
  label.textContent = val==='all' ? 'All' : val.charAt(0).toUpperCase()+val.slice(1);
  const sel = document.getElementById('categorySelect'); if(sel) sel.value = val;
  // close dropdown
  if(dd) { dd.classList.remove('open'); dd.setAttribute('aria-expanded','false'); }
  // apply filter and scroll to products + highlight
  const filtered = filterCollection(val);
  // ensure product grid reflects selection
  try{ loadProducts(filtered); }catch(e){}
  // scroll into view
  const productsAnchor = document.getElementById('products');
  if(productsAnchor){ productsAnchor.scrollIntoView({behavior:'smooth',block:'start'}); }
  // highlight matching cards briefly
  setTimeout(()=>{
    const ids = new Set(filtered.map(p=>p.id));
    document.querySelectorAll('#productGrid .product-card').forEach(card=>{
      const id = card.dataset?.id || card.getAttribute('data-id');
      if(ids.has(id)){
        card.classList.add('card-highlight');
        setTimeout(()=>card.classList.remove('card-highlight'),900);
      }
    });
  },350);
}

function onCategorySelect(val){
  filterCollection(val);
}

//----------------------- CART LOGIC --------------------------
let cart = JSON.parse(localStorage.getItem('cart')||"[]");
function addToCart(product,isDetail=false){
  // On detail modal, require size/color if exists
  let size = isDetail && Array.isArray(product.sizes) && product.sizes.length>0 ? window.modalSize : null;
  let color = isDetail && Array.isArray(product.colors) && product.colors.length>0 ? window.modalColor : null;
  if(isDetail){
    if(product.sizes?.length>0 && !size){showToast("Select a size!");return;}
    if(product.colors?.length>0 && !color){showToast("Select a color!");return;}
  }
  let existingIdx = cart.findIndex(i=>i.id===product.id && (!product.sizes || i.size===size) && (!product.colors || i.color?.label===color?.label));
  if(existingIdx>-1) cart[existingIdx].qty += 1;
  else cart.push({...product,qty:1,size:size,color:color});
  saveCart();
  showToast("Added to cart!");
  document.getElementById('prodDetailInCart')?.classList.remove('hidden');
}
function saveCart(){
  localStorage.setItem('cart',JSON.stringify(cart));
  updateCartCount();
}
function updateCartCount(){
  document.getElementById('cartCount').textContent = cart.reduce((s,i)=>s+i.qty,0);
}
function toggleModal(id){
  const mod = document.getElementById(id);
  const opener = mod.classList.contains('hidden');
  if(id==='checkoutModal'){
    mod.classList.toggle('fullscreen', opener);
  }
  document.body.style.overflowY = opener ? 'hidden' : '';
  mod.classList.toggle('hidden');
  if(id==='cartModal' && opener) renderCart();
  if(id==='checkoutModal' && opener){resetCheckout();renderCardPreview();}
  if(id==='supportModal')document.getElementById('supportThank').classList.add('hidden');
}
function closeModalOutside(e,id){
  if(e.target.id===id){toggleModal(id);}
}
function showToast(msg){
  const toast=document.getElementById('toast');
  document.getElementById('toastMsg').textContent=msg;
  toast.classList.remove('hidden');
  setTimeout(()=>toast.classList.add('hidden'),1800);
}
// Cart rendering
function renderCart(){
  const items = document.getElementById('cartItems');
  const empty = document.getElementById('cartEmpty');
  const footer = document.getElementById('cartFooter');
  let subtotal = 0;
  if(!cart.length){
    empty.classList.remove('hidden');
    footer.classList.add('hidden');
    items.innerHTML = '';
    document.getElementById('cartSubtotal').textContent = '$0';
    document.getElementById('cartTotal').textContent = '$0';
    return;
  }
  empty.classList.add('hidden');
  footer.classList.remove('hidden');
  items.innerHTML = '';
  cart.forEach((item,i)=>{
    let opts = `${item.size? `Size: <b>${item.size}</b> `:""}${item.color?`Color: <span style='background:${item.color.color};padding:0 7px;border-radius:8px;color:#181f1b;margin-left:2px'>${item.color.label}</span>`:""}`;
    let detail = `<span class="text-xs text-gray-500">${opts}</span>`;
    subtotal += item.price*item.qty;
    items.innerHTML += `
      <div class="flex items-center gap-4">
        <img src="${item.img}" class="w-16 h-16 object-cover rounded-lg"/>
        <div class="flex-1"><p class="font-semibold">${item.name}</p>${detail}
        <div>Qty: 
          <button onclick="changeQty(${i},-1)" class="px-2">-</button>${item.qty}<button onclick="changeQty(${i},1)" class="px-2">+</button>
        </div>
        </div>
        <p class="font-bold">$${item.price*item.qty}</p>
        <i class="fa-solid fa-trash cursor-pointer ml-2 text-gray-400 hover:text-red-400" onclick="removeCartItem(${i})"></i>
      </div>
    `;
  });
  document.getElementById('cartSubtotal').textContent = '$'+subtotal;
  document.getElementById('cartShipping').textContent = subtotal>=250 ? 'FREE' : '$8';
  document.getElementById('cartTotal').textContent = '$'+(subtotal+(subtotal>=250 ? 0 : 8));
}
function changeQty(i,d){
  if(cart[i].qty+d<=0) cart.splice(i,1);
  else cart[i].qty += d;
  saveCart();
  renderCart();
}
function removeCartItem(i){
  cart.splice(i,1);
  saveCart();
  renderCart();
}
updateCartCount();

//------------------- CHECKOUT ------------------
let selectedAddress = profile.addresses.find(a=>a.isDefault) || profile.addresses[0];
let selectedFulfillment = 'shipping'; // 'shipping' or 'pickup'
let selectedTip = 0;
let pickupLocations = [
  { id: 'store-dt', name: 'Downtown Store', street: '120 Market St', city: 'Long Beach, CA 90802', phone: '+1 562-555-0101' },
  { id: 'store-pl', name: 'Pacific Plaza', street: '500 Pacific Ave', city: 'Long Beach, CA 90802', phone: '+1 562-555-0202' },
  { id: 'store-la', name: 'LA Flagship', street: '700 S Flower St', city: 'Los Angeles, CA 90017', phone: '+1 323-555-0303' }
];
let selectedPickupLocation = pickupLocations[0];
function renderCheckoutAddress(){
  let box=document.getElementById("checkoutAddressBox");
  if(!selectedAddress)return box.innerHTML="No address. Add one in your dashboard.";
  if(selectedFulfillment === 'pickup'){
    // show selected pickup location
    const loc = selectedPickupLocation || pickupLocations[0];
    box.innerHTML = `<b>${loc.name}</b> <span class="text-[#C2A878] ml-2 text-xs font-bold">Pickup Location</span><br>${loc.street}, ${loc.city}<br>${loc.phone}`;
  } else {
    box.innerHTML=`<b>${selectedAddress.name}</b> <span class="text-[#C2A878] ml-2 text-xs font-bold">${selectedAddress.label||''}</span>
      <br>${selectedAddress.street}, ${selectedAddress.city}
      <br>${selectedAddress.country}
      <br>${selectedAddress.phone}`;
  }
}
function editCheckoutAddress(){
  // If we want, open address panel in dashboard, or just let user cycle address
  let idx=profile.addresses.findIndex(a=>a.id===selectedAddress.id);
  idx = (idx+1)%profile.addresses.length;
  selectedAddress = profile.addresses[idx];
  renderCheckoutAddress();
}
function openCheckout(){
  if(!cart.length) return showToast("Cart is empty!");
  // prepare pickup locations and UI
  populatePickupLocations();
  // default to shipping unless all items are pickup-only (not implemented)
  setFulfillment('shipping');
  renderCheckoutAddress();
  renderCheckoutSummaryCart();
  resetCheckout();
  // Close the cart modal first, then open checkout once the cart overlay is hidden.
  const cartMod = document.getElementById('cartModal');
  toggleModal('cartModal');
  // Poll for the cart modal to become hidden (fallback after 700ms)
  (function waitForCartHidden(maxWait = 700, interval = 40){
    const start = Date.now();
    const iv = setInterval(()=>{
      const now = Date.now();
      if(!cartMod || cartMod.classList.contains('hidden') || (now - start) > maxWait){
        clearInterval(iv);
        // open checkout
        toggleModal('checkoutModal');
      }
    }, interval);
  })();
}
function renderCheckoutSummaryCart(){
  let box=document.getElementById('checkoutSummaryCart');
  let subtotal = 0, summary='';
  cart.forEach(item=>{
    subtotal+=(item.price*item.qty);
    summary+=`
      <div class="flex items-center gap-2 mb-1">
        <img src="${item.img}" class="w-8 h-8 rounded-lg"/> 
        <span>${item.name}</span>
        ${item.size?`<span class="text-xs text-[#C2A878] border border-[#C2A878]/10 px-1 rounded"> ${item.size}</span>`:""}
        ${item.color?`<span class="text-xs px-1 ml-1 rounded" style="background:${item.color.color};color:#14181b">${item.color.label}</span>`:""}
        <span class="text-xs text-gray-400">×${item.qty}</span>
        <span class="ml-auto font-bold">$${item.price*item.qty}</span>
      </div>
    `;
  });
  document.getElementById('checkoutSubtotal').textContent = '$'+subtotal;
  // compute shipping based on fulfillment
  let shipping = 0;
  if(selectedFulfillment === 'shipping'){
    shipping = subtotal>=250?0:8;
    document.getElementById('checkoutShippingLabel').textContent = 'Shipping (Estimate)';
    document.getElementById('checkoutShippingAmount').textContent = shipping===0? 'FREE' : '$'+shipping.toFixed(2);
  } else {
    // pickup
    shipping = 0;
    document.getElementById('checkoutShippingLabel').textContent = 'Pickup';
    document.getElementById('checkoutShippingAmount').textContent = 'Free';
  }
  // include tip in the total
  const tip = Number(selectedTip || 0);
  document.getElementById('checkoutTipAmount').textContent = '$'+tip.toFixed(2);
  document.getElementById('checkoutTotal').textContent = '$'+(subtotal+shipping+tip);
  box.innerHTML = summary;
}

// Tip helpers
function setTip(amount){
  selectedTip = Number(amount)||0;
  document.querySelectorAll('.tip-btn').forEach(b=>{
    const val = Number(b.textContent.replace(/[^0-9.]/g,'')) || 0;
    b.classList.toggle('selected', val === Number(amount));
  });
  const custom = document.getElementById('customTipInput'); if(custom) custom.value = '';
  renderCheckoutSummaryCart();
}
function onCustomTipChange(val){
  if(!val){ selectedTip = 0; }
  else selectedTip = Math.max(0, Number(val));
  document.querySelectorAll('.tip-btn').forEach(b=>b.classList.remove('selected'));
  renderCheckoutSummaryCart();
}

function populatePickupLocations(){
  const sel = document.getElementById('pickupLocationSelect');
  if(!sel) return;
  sel.innerHTML = '';
  pickupLocations.forEach(loc=>{
    const o = document.createElement('option'); o.value = loc.id; o.textContent = `${loc.name} — ${loc.city}`;
    sel.appendChild(o);
  });
  // select default
  sel.value = selectedPickupLocation?.id || pickupLocations[0].id;
  onPickupLocationChange(sel.value);
}

function onPickupLocationChange(id){
  const loc = pickupLocations.find(l=>l.id===id) || pickupLocations[0];
  selectedPickupLocation = loc;
  renderCheckoutAddress();
}

function setFulfillment(method){
  selectedFulfillment = method==='pickup' ? 'pickup' : 'shipping';
  const shipBtn = document.getElementById('fulfillShippingBtn');
  const pickBtn = document.getElementById('fulfillPickupBtn');
  const pickupBox = document.getElementById('pickupBox');
  const addrLabel = document.getElementById('checkoutAddressLabel');
  if(selectedFulfillment === 'pickup'){
    shipBtn.classList.remove('tab-active');
    pickBtn.classList.add('tab-active');
    pickupBox.classList.remove('hidden');
    addrLabel.textContent = 'Pickup Location';
  } else {
    pickBtn.classList.remove('tab-active');
    shipBtn.classList.add('tab-active');
    pickupBox.classList.add('hidden');
    addrLabel.textContent = 'Shipping Address';
  }
  renderCheckoutAddress();
  renderCheckoutSummaryCart();
}

//Animated Card Preview for Payment Form
function renderCardPreview(){
  updateCardPreview();
  document.getElementById('cardInner').classList.remove('flipped');
}
function updateCardPreview(){
  const name = document.getElementById('inputCardName')?.value || 'YOUR NAME';
  const date = document.getElementById('inputCardExpiry')?.value || 'MM/YY';
  const cvv = document.getElementById('inputCardCvv')?.value || '•••';
  document.getElementById('cardNameDisplay').textContent = name;
  document.getElementById('cardExpiryDisplay').textContent = date;
  document.getElementById('cardCvvDisplay').textContent = cvv.padEnd(3,"•").slice(0,4);
}
function formatAndUpdateCardNumber(){
  let v = document.getElementById('inputCardNumber').value.replace(/\D/g,'').substring(0,16);
  v = v.replace(/(.{4})/g,"$1 ").trim();
  document.getElementById('inputCardNumber').value = v;
  document.getElementById('cardNumberDisplay').textContent = v ? v.padEnd(19,"•") : '•••• •••• •••• ••••';
  document.getElementById('cardInner').classList.remove('flipped');
}
function formatAndUpdateCardExpiry(){
  let v = document.getElementById('inputCardExpiry').value.replace(/\D/g,'');
  if(v.length > 2) v = v.substr(0,2) + '/' + v.substr(2,2);
  document.getElementById('inputCardExpiry').value = v;
  updateCardPreview();
  document.getElementById('cardInner').classList.remove('flipped');
}
document.getElementById('inputCardCvv')?.addEventListener('focus',()=>document.getElementById('cardInner').classList.add('flipped'));
document.getElementById('inputCardCvv')?.addEventListener('blur',()=>document.getElementById('cardInner').classList.remove('flipped'));

//---- Checkout submission/confirmation ----
function submitCheckout(e){
  e.preventDefault();
  if(!cart.length)return showToast("Cart empty!");
  // Simulate payment...
  let subtotal = cart.reduce((s, i)=>s+i.price*i.qty,0);
  let shipping=subtotal>=250?0:8;
  let tipAmt = Number(selectedTip || 0);
  let points = Math.round((subtotal+shipping+tipAmt)*1.1);
  // Update loyalty
  let pprofile = getProfile();
  pprofile.loyalty.points += points;
  pprofile.loyalty.credit = "$" + (Math.floor(pprofile.loyalty.points/10)).toFixed(2);
  pprofile.loyalty.history.unshift(`+${points} pts — Checkout Reward<br><span class='text-gray-400'>${new Date().toISOString().slice(0,10)}</span>`);
  setProfile(pprofile); profile=pprofile;
  cart=[];
  saveCart();
  document.getElementById('checkoutForm').classList.add('hidden');
  document.getElementById('checkoutSuccess').classList.remove('hidden');
  document.getElementById('loyaltyEarnings').innerText = points;
  // clear selected tip after successful payment
  selectedTip = 0;
  const custom = document.getElementById('customTipInput'); if(custom) custom.value = '';
  const tipDisplay = document.getElementById('checkoutTipAmount'); if(tipDisplay) tipDisplay.textContent = '$0.00';
  updateCartCount();renderDashboard();
}
function resetCheckout(){
  document.getElementById('checkoutForm').reset();
  document.getElementById('checkoutForm').classList.remove('hidden');
  document.getElementById('checkoutSuccess').classList.add('hidden');
  renderCardPreview();
  // reset tip selection
  selectedTip = 0;
  document.querySelectorAll('.tip-btn').forEach(b=>b.classList.remove('selected'));
  const custom = document.getElementById('customTipInput'); if(custom) custom.value = '';
  const tipDisplay = document.getElementById('checkoutTipAmount'); if(tipDisplay) tipDisplay.textContent = '$0.00';
}
function closeCheckoutModal(){
  toggleModal('checkoutModal');
}

//------------------ DASHBOARD & PROFILE ---------------------
function renderDashboard(){
  profile = getProfile();
  document.getElementById('dashboardWelcome').textContent = `Welcome back, ${profile.name.split(' ')[0]||''}`;
  // Orders
  let orderbox=document.getElementById('orderList'),ohtml='';
  profile.orders.forEach(o=>{
    ohtml+=`
      <div class="glass rounded-2xl p-6 mb-2">
        <div class="flex justify-between items-start mb-2">
          <div><p class="text-[#C2A878] text-sm">${o.n}</p><p class="text-gray-400 text-sm">${o.date}</p></div>
          <span class="bg-${o.statusColor}-500/20 text-${o.statusColor}-400 px-3 py-1 rounded-full text-sm">${o.status}</span>
        </div>
        ${o.items.map(it=>`
          <div class="flex gap-4 items-center">
            <img src="${it.img}" class="w-14 h-14 rounded-lg object-cover"/>
            <div class="flex-1"><p class="font-semibold">${it.name}</p><p class="text-gray-500 text-xs">${it.detail}</p></div>
            <p class="font-bold">$${it.price*it.qty}</p>
          </div>
        `).join('')}
        <div class="text-right mt-3 font-bold text-[#C2A878]">Order total: $${o.total}</div>
      </div>
    `;
  });
  orderbox.innerHTML=ohtml;

  // Addresses
  let abox=document.getElementById('panel-addresses'),ahtml='';
  profile.addresses.forEach((a,i)=>{
    ahtml+=`
    <div class="glass rounded-2xl p-6 border-2 ${a.isDefault?'border-[#C2A878]':'border-white/20'} relative">
    <div class="flex items-center justify-between mb-3">
      <span class="text-xs font-semibold" style="color:${a.isDefault?'#C2A878':'#ead9b7'}">${a.label||''} ${a.isDefault?"(default)":""}</span>
      <i class="fa-solid fa-pen text-gray-500 cursor-pointer hover:text-white" onclick="editAddress('${a.id}')"></i>
    </div>
    <b>${a.name}</b><br>${a.street}<br>${a.city}<br>${a.country}<br>
    <span class="text-gray-500 text-xs">${a.phone}</span>
    <button class="glass px-2 py-1 text-xs rounded mt-2 hover:bg-[#C2A878]/10" onclick="setDefaultAddress('${a.id}')">Set Default</button>
    </div>
    `;
  });
  ahtml+=`
    <div class="glass rounded-2xl p-6 border-2 border-dashed border-white/20 flex items-center justify-center cursor-pointer hover:border-[#C2A878] transition" onclick="addDummyAddress()">
      <div class="text-center"><i class="fa-solid fa-plus text-2xl text-gray-500 mb-2"></i><p class="text-gray-500">Add New Address</p></div>
    </div>
  `;
  abox.innerHTML=ahtml;

  // Cards
  let cbox=document.getElementById('panel-cards'),chtml='';
  profile.cards.forEach(c=>{
    chtml+=`
      <div class="rounded-2xl p-6 bg-gradient-to-br from-[#1a2f28] to-[#2a4a3f] border ${c.isDefault?'border-[#C2A878]':'border-white/10'}">
        <div class="flex justify-between mb-8"><i class="fa-brands fa-cc-${c.brand.toLowerCase()} text-3xl"></i><span class="text-[#C2A878] text-xs">${c.isDefault?'DEFAULT':''}</span></div>
        <p class="text-xl tracking-widest mb-6">•••• •••• •••• ${c.last}</p>
        <div class="flex justify-between"><div><p class="text-gray-500 text-xs">CARDHOLDER</p><p class="text-sm">${c.holder}</p></div><div><p class="text-gray-500 text-xs">EXPIRES</p><p class="text-sm">${c.exp}</p></div></div>
      </div>
    `;
  });
  chtml+=`
    <div class="glass rounded-2xl p-6 border-2 border-dashed border-white/20 flex items-center justify-center cursor-pointer hover:border-[#C2A878] transition" onclick="addDummyCard()">
      <div class="text-center"><i class="fa-solid fa-plus text-2xl text-gray-500 mb-2"></i><p class="text-gray-500">Add New Card</p></div>
    </div>
  `;
  cbox.innerHTML=chtml;

  // Loyalty
  document.getElementById("loyaltyPoints").innerText = `${profile.loyalty.points} pts`;
  document.getElementById("loyaltyCredit").innerText = `${profile.loyalty.credit} store credit`;
  document.getElementById("loyaltyHistory").innerHTML=profile.loyalty.history.slice(0,5).map(e=>`<li>${e}</li>`).join('');

  // Settings
  document.getElementById('settingsName').value = profile.name;
  document.getElementById('settingsEmail').value = profile.email;
  document.getElementById('settingsPhone').value = profile.phone;
}
// ------------------- ADMIN DASHBOARD HELPERS ------------------
function computeAdminMetrics(){
  let gross = 0, losses = 0, ordersCount = 0, returnsList = [];
  fakeUsers.forEach(u=>{
    u.orders.forEach(o=>{ gross += (o.total||0); ordersCount += 1; });
    (u.returns||[]).forEach(r=>{ losses += (r.amount||0); returnsList.push(Object.assign({user:u.name}, r)); });
  });
  // compute total rewards given
  const rewardsGiven = fakeUsers.reduce((s,u)=>s + (u.rewardsGiven||0),0);
  return { gross, losses, ordersCount, returnsList, rewardsGiven };
}

function topProducts(limit=5){
  const tally = {};
  fakeUsers.forEach(u=>{
    u.orders.forEach(o=>{
      (o.items||[]).forEach(it=>{ tally[it.id] = (tally[it.id]||0) + (it.qty||0); });
    });
  });
  const arr = Object.entries(tally).map(([id,qty])=>({id,qty})).sort((a,b)=>b.qty-a.qty).slice(0,limit);
  return arr.map(a=>{ const p = products.find(pp=>pp.id===a.id) || {name:a.id,img:''}; return { id:a.id, qty:a.qty, name:p.name||a.id, img:p.img||'' }; });
}

function renderAdminDashboard(){
  const m = computeAdminMetrics();
  document.getElementById('adminGross').innerText = `$${m.gross}`;
  document.getElementById('adminLoss').innerText = `$${m.losses}`;
  document.getElementById('adminOrdersCount').innerText = m.ordersCount;
  // rewards given
  const rewardsEl = document.getElementById('adminRewards');
  if(rewardsEl) rewardsEl.innerText = `$${m.rewardsGiven}`;
  // top products
  const top = topProducts();
  const topEl = document.getElementById('adminTopProducts'); topEl.innerHTML='';
  top.forEach(t=>{
    const el = document.createElement('div'); el.className='flex items-center gap-3';
    el.innerHTML = `<img src="${t.img}" class="w-12 h-12 object-cover rounded-md"/><div><div class="font-semibold">${t.name}</div><div class="text-xs text-gray-400">${t.qty} sold</div></div>`;
    topEl.appendChild(el);
  });
  // returns
  const retEl = document.getElementById('adminReturns'); retEl.innerHTML = m.returnsList.length? m.returnsList.map(r=>`<div class="mb-2">${r.user} — ${r.order} — $${r.amount} — ${r.reason}</div>`).join('') : '<div class="text-gray-400">No recent returns</div>';
  // users table
  renderUsersTable(fakeUsers);
  // current orders list
  renderCurrentOrders();
}

function renderCurrentOrders(){
  const el = document.getElementById('adminCurrentOrders');
  if(!el) return;
  const rows = [];
  fakeUsers.forEach(u=>{
    (u.orders||[]).forEach((o,idx)=>{
      rows.push({ user:u.name, uid:u.id, order:o, uidx:idx });
    });
  });
  el.innerHTML = rows.length? rows.map(r=>{
    const status = r.order.status||'Pending';
    return `
      <div class="admin-order" data-order="${r.order.n}">
        <div>
          <div class="font-semibold">${r.order.n} — ${r.user}</div>
          <div class="text-xs text-gray-400">${r.order.date} • $${r.order.total} • ${r.order.items.map(it=>it.id+'×'+it.qty).join(', ')}</div>
        </div>
        <div class="flex items-center gap-2">
          <div class="text-sm text-gray-300 mr-2">${status}</div>
          ${status!=='Completed'? `<button class="admin-action-btn" onclick="markOrderComplete('${r.uid}', ${r.uidx})">Complete</button>` : `<button class="glass px-3 py-1 rounded-md">Completed</button>`}
        </div>
      </div>
    `; }).join('') : '<div class="text-gray-400">No current orders</div>';
}

function markOrderComplete(userId, orderIdx){
  const user = fakeUsers.find(u=>u.id===userId); if(!user) return;
  const order = user.orders[orderIdx]; if(!order) return;
  order.status = 'Completed';
  // small visual feedback
  showToast(`Marked ${order.n} as completed`);
  renderAdminDashboard();
}

function resetReturn(userId, returnIdx){
  const user = fakeUsers.find(u=>u.id===userId); if(!user) return;
  if(!user.returns || !user.returns[returnIdx]) return;
  user.returns.splice(returnIdx,1);
  showToast('Return cleared');
  renderAdminDashboard();
}

function saveReturnExplanation(userId, returnIdx){
  const ta = document.getElementById(`return-explain-${userId}-${returnIdx}`);
  if(!ta) return; const user = fakeUsers.find(u=>u.id===userId); if(!user) return;
  user.returns[returnIdx].explanation = ta.value;
  showToast('Explanation saved');
}

function showAdminDisclaimer(){
  if(window._adminDisclaimerShown) return;
  window._adminDisclaimerShown = true;
  const modal = document.getElementById('adminDisclaimerModal'); if(!modal) return;
  modal.style.display = 'flex';
}

function closeAdminDisclaimer(){ document.getElementById('adminDisclaimerModal').style.display='none'; }

function renderUsersTable(list){
  const el = document.getElementById('adminUsersTable');
  el.innerHTML = list.map(u=>{
    const totalSpent = (u.orders||[]).reduce((s,o)=>s+(o.total||0),0);
    return `<div class="admin-user-row p-3 border-b border-white/6 flex items-center justify-between"><div><div class="font-semibold">${u.name}</div><div class="text-xs text-gray-400">${u.email}</div></div><div class="text-sm text-gray-200">$${totalSpent}</div></div>`;
  }).join('');
  initAdminUsersScroll();
}

function initAdminUsersScroll(){
  const el = document.getElementById('adminUsersTable');
  if(!el) return;
  let raf = null;
  function onScroll(){
    if(raf) cancelAnimationFrame(raf);
    raf = requestAnimationFrame(()=>{
      const top = el.scrollTop > 2;
      const atBottom = el.scrollTop + el.clientHeight >= el.scrollHeight - 2;
      el.classList.toggle('has-scroll', top);
      el.classList.toggle('at-bottom', atBottom);
      // add temporary scrolling class for row motion
      el.classList.add('scrolling');
      clearTimeout(el._scrollTimer);
      el._scrollTimer = setTimeout(()=> el.classList.remove('scrolling'), 120);
    });
  }
  el.removeEventListener('scroll', el._adminScrollHandler || onScroll);
  el._adminScrollHandler = onScroll;
  el.addEventListener('scroll', onScroll, {passive:true});
  // run once to set initial state
  setTimeout(()=>{ onScroll(); },50);
}

function searchUsers(q){
  q = (q||'').toLowerCase().trim();
  if(!q) return renderUsersTable(fakeUsers);
  const filtered = fakeUsers.filter(u=>u.name.toLowerCase().includes(q) || u.email.toLowerCase().includes(q));
  renderUsersTable(filtered);
}
function setDefaultAddress(id){
  profile.addresses.forEach(a=>a.isDefault=(a.id===id));
  setProfile(profile); renderDashboard();
}
function addDummyAddress(){
  let id='addr'+Math.random().toString(16).slice(2,8);
  profile.addresses.push({
    id,label:"Other",name:profile.name,
    street:"100 New Rd",city:"Los Angeles, CA 90001",
    country:"United States",phone:"+1 555-555-5555",isDefault:false
  });
  setProfile(profile); renderDashboard();
}
function editAddress(id){
  alert("Edit address coming soon! (for demo, add/remove via code)");
}
function addDummyCard(){
  let id='cc'+Math.random().toString(16).slice(2,8);
  profile.cards.push({id,brand:"Visa",last:"7890",holder:profile.name.toUpperCase(),exp:"07/30",isDefault:false});
  setProfile(profile); renderDashboard();
}
function saveProfileSettings(){
  profile.name=document.getElementById('settingsName').value;
  profile.email=document.getElementById('settingsEmail').value;
  profile.phone=document.getElementById('settingsPhone').value;
  setProfile(profile);
  showToast("Profile updated!");renderDashboard();
}

//------------------- DASHBOARD TABS -------------------------
function showTab(tab){
  ['orders','addresses','cards','admin','settings','loyalty'].forEach(t=>{
    const tabEl = document.getElementById('tab-'+t);
    if(tabEl) tabEl.classList.remove('tab-active');
    const panel = document.getElementById('panel-'+t);
    if(panel) panel.classList.add('hidden');
  });
  const targetTab = document.getElementById('tab-'+tab); if(targetTab) targetTab.classList.add('tab-active');
  const targetPanel = document.getElementById('panel-'+tab); if(targetPanel) targetPanel.classList.remove('hidden');
  if(tab === 'admin') renderAdminDashboard();
  if(tab === 'admin') showAdminDisclaimer();
}
showTab('orders');

// SUPPORT + FAQ
function openSupportModal(){toggleModal('supportModal')}
document.getElementById("supportForm").onsubmit = (e)=>{
  e.preventDefault();
  document.getElementById("supportThank").classList.remove('hidden');
  setTimeout(()=>toggleModal('supportModal'),1700);
};
// Support chat behavior (simple AI-like canned responses)
function showSupportTab(tab){
  document.getElementById('faqTab').style.display = tab==='faq' ? 'block' : 'none';
  document.getElementById('chatTab').style.display = tab==='chat' ? 'block' : 'none';
  document.getElementById('faqTabBtn').classList.toggle('tab-active', tab==='faq');
  document.getElementById('chatTabBtn').classList.toggle('tab-active', tab==='chat');
  if(tab==='chat') setTimeout(()=>{ document.getElementById('chatInput').focus(); },120);
}

function initSupportChat(){
  const msgs = document.getElementById('chatMessages');
  const input = document.getElementById('chatInput');
  const send = document.getElementById('chatSendBtn');
  if(!msgs || !input || !send) return;
  function appendMessage(who, text){
    const d = document.createElement('div');
    d.className = who==='bot' ? 'text-sm text-gray-200 mb-2' : 'text-sm text-[#0b1a14] mb-2';
    d.style.display='block';
    d.innerHTML = who==='bot' ? `<div class="glass p-3 rounded-xl">${text}</div>` : `<div style="background:#C2A878;color:#04120c;padding:8px;border-radius:12px;display:inline-block">${text}</div>`;
    msgs.appendChild(d);
    msgs.scrollTop = msgs.scrollHeight;
  }
  function botReply(usr){
    // simple rule-based canned responses
    const q = (usr||'').toLowerCase();
    let reply = "I'm here to help — ask me about shipping, returns, sizes, or pickup.";
    if(q.includes('shipping')) reply = 'Domestic shipping usually takes 2-5 business days. Orders over $250 ship free.';
    else if(q.includes('return')) reply = 'Returns are free within 30 days — just bring your order number.';
    else if(q.includes('size')) reply = 'Check the size chart on the product page — most items run true to size.';
    else if(q.includes('pickup')) reply = 'Pickup is available at our stores. Choose Pickup at checkout and select a location.';
    else if(q.includes('hello')||q.includes('hi')) reply = 'Hi! I can help with shipping, returns, product info, and pickup.';
    // simulate typing
    appendMessage('bot','...');
    setTimeout(()=>{
      // remove last typing indicator
      const last = msgs.lastChild; if(last) msgs.removeChild(last);
      appendMessage('bot',reply);
    }, 800 + Math.random()*800);
  }
  send.onclick = ()=>{
    const txt = input.value.trim(); if(!txt) return;
    appendMessage('user', txt);
    input.value = '';
    setTimeout(()=>botReply(txt), 300);
  };
  input.addEventListener('keydown',(e)=>{ if(e.key==='Enter'){ e.preventDefault(); send.click(); } });
}
// initialize chat when modal opens
document.addEventListener('click',(e)=>{ if(e.target.closest('#supportFab') || e.target.closest('#supportModal')){ setTimeout(()=>initSupportChat(),150); } });
function toggleFaq(el){
  let isActive=el.classList.toggle('active');
  let answer=el.nextElementSibling;
  answer.style.display=isActive?'block':'none';
  if(isActive){setTimeout(()=>{answer.scrollIntoView({behavior:'smooth',block:"center"})},150);}
}
// Navbar hide-on-scroll: hides navbar when scrolling down, shows when scrolling up.
function initNavbarScroll(){
  const nav = document.getElementById('navbar');
  if(!nav) return;
  let lastY = window.scrollY || 0;
  let ticking = false;
  const threshold = 10; // pixels before we consider it a real scroll
  function onScroll(){
    const y = window.scrollY || 0;
    if(!ticking){
      window.requestAnimationFrame(()=>{
        const delta = y - lastY;
        if(Math.abs(delta) > threshold){
          if(delta > 0 && y > 80){ // scrolled down
            nav.classList.add('hide');
          } else { // scrolled up
            nav.classList.remove('hide');
          }
          lastY = y;
        }
        ticking = false;
      });
      ticking = true;
    }
  }
  window.addEventListener('scroll', onScroll, {passive:true});
}
//------------------- INITIAL LOAD + EXTRAS  -----------------
renderDashboard();
initNavbarScroll();
</script>
</body>
</html>
