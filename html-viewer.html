<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Mini VS Code HTML Runner</title>
  <style>
    html, body {
      margin: 0;
      height: 100%;
      display: flex;
      flex-direction: column;
      background: #1e1e1e;
      color: white;
      font-family: system-ui, sans-serif;
    }
    #toolbar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: #2d2d2d;
      padding: 8px 12px;
      border-bottom: 1px solid #333;
    }
    button {
      background: #0e639c;
      color: white;
      border: none;
      padding: 8px 14px;
      border-radius: 4px;
      cursor: pointer;
      font-weight: 600;
    }
    button:hover { background: #1177bb; }
    #main {
      display: flex;
      flex: 1;
      overflow: hidden;
    }
    #sidebar {
      width: 220px;
      background: #252526;
      overflow-y: auto;
      padding: 8px;
      border-right: 1px solid #333;
    }
    #sidebar div {
      padding: 4px 8px;
      cursor: pointer;
      border-radius: 4px;
    }
    #sidebar div:hover { background: #333; }
    #editor { flex: 1; }
    #preview {
      flex: 1;
      border: none;
      background: white;
    }
    input[type=file] { display: none; }
  </style>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.45.0/min/vs/loader.min.js"></script>
</head>
<body>
  <div id="toolbar">
    <label for="folderInput"><button>üìÅ Upload Folder</button></label>
    <input type="file" id="folderInput" webkitdirectory multiple />
    <button id="runBtn">‚ñ∂Ô∏è Run</button>
  </div>

  <div id="main">
    <div id="sidebar"></div>
    <div id="editor"></div>
    <iframe id="preview"></iframe>
  </div>

  <script>
    let files = {};
    let currentFile = null;
    let editor;

    require.config({ paths: { vs: "https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.45.0/min/vs" } });
    require(["vs/editor/editor.main"], () => {
      editor = monaco.editor.create(document.getElementById("editor"), {
        value: "<!-- Upload a folder to start -->",
        language: "html",
        theme: "vs-dark",
        automaticLayout: true
      });

      document.getElementById("folderInput").addEventListener("change", async (e) => {
        const fileList = e.target.files;
        files = {};
        const sidebar = document.getElementById("sidebar");
        sidebar.innerHTML = "";

        for (const file of fileList) {
          files[file.webkitRelativePath] = file;
          const div = document.createElement("div");
          div.textContent = file.webkitRelativePath;
          div.onclick = async () => {
            const text = await file.text();
            currentFile = file.webkitRelativePath;
            const ext = file.name.split(".").pop();
            monaco.editor.setModelLanguage(editor.getModel(),
              ext === "css" ? "css" : ext === "js" ? "javascript" : "html");
            editor.setValue(text);
          };
          sidebar.appendChild(div);
        }
      });

      editor.onDidChangeModelContent(() => {
        if (currentFile) {
          const blob = new Blob([editor.getValue()], { type: "text/plain" });
          files[currentFile] = new File([blob], currentFile);
        }
      });

      document.getElementById("runBtn").addEventListener("click", async () => {
        const indexPath = Object.keys(files).find(f => f.endsWith("index.html"));
        if (!indexPath) return alert("No index.html found in folder!");

        const fileMap = {};
        for (const path in files) {
          const file = files[path];
          const blob = new Blob([await file.text()], {
            type: path.endsWith(".js") ? "text/javascript" :
                  path.endsWith(".css") ? "text/css" : "text/html"
          });
          fileMap[path.split("/").pop()] = URL.createObjectURL(blob);
        }

        let html = await files[indexPath].text();
        for (const [name, url] of Object.entries(fileMap)) {
          html = html.replace(new RegExp(name, "g"), url);
        }

        document.getElementById("preview").srcdoc = html;
      });
    });
  </script>
</body>
</html>
